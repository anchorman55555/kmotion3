var KM={};KM.RED="#FF0000";KM.YELLOW="#FFFF00";KM.GREEN="#00FF00";KM.BLUE="#0000FF";KM.BLACK="#000000";KM.BAR="#9696FF";KM.WHITE="#FFFFFF";KM.GREY="#C1C1C1";KM.DARK_GREY="#818181";KM.GHOST="#E2E2E2";KM.BUTTON_BAR=0;KM.ERROR_DAEMON=1;KM.GET_DATA=2;KM.FEED_CACHE=3;KM.DISPLAY_LOOP=4;KM.ARCH_LOOP=5;KM.LOGS=6;KM.CONFIG_LOOP=7;KM.server={latest_jpegs:[],latest_events:[],feed_caches:[],servo_state:0};KM.browser={browser_FF:false,browser_IE:false,browser_OP:false,browser_SP:false,main_display_width:0,main_display_height:0};KM.session_id={current:0};KM.menu_bar_buttons={function_selected:0,display_sec_enabled:false,camera_sec_enabled:false,func_sec_enabled:false,ptz_sec_enabled:false};KM.live={last_camera_select:0,ptz_feed:0};KM.config={session_id:0,pwd_change:false,camera:0,mask:"",ptz_current_x:0,ptz_current_y:0,error_str:"",error_search_str:/failed|error/i};KM.www_rc={feed_enabled:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],feed_show_box:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],feed_mask:["pad","","","","","","","","","","","","","","","",""],feed_device:["pad","","","","","","","","","","","","","","","",""],feed_url:["pad","","","","","","","","","","","","","","","",""],feed_proxy:["pad","","","","","","","","","","","","","","","",""],feed_lgn_name:["pad","","","","","","","","","","","","","","","",""],feed_lgn_pw:["pad","","","","","","","","","","","","","","","",""],feed_name:["pad","","","","","","","","","","","","","","","",""],feed_input:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_width:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_height:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_snap_enabled:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],feed_smovie_enabled:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],feed_movie_enabled:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],feed_updates:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],feed_snap_interval:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_fps:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_quality:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_kbs:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_enabled:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],ptz_calib_first:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],ptz_servo_settle:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_step_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_step_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_park_enabled:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],ptz_track_type:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_park_delay:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_park_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_park_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset1_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset1_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset2_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset2_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset3_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset3_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset4_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset4_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],display_cameras:[],interleave:false,full_screen:false,low_bandwidth:false,low_cpu:false,skip_frames:false,archive_button_enabled:true,logs_button_enabled:true,config_button_enabled:true,func_button_enabled:true,msg_button_enabled:true,about_button_enabled:true,logout_button_enabled:true,func_enabled:["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],secure:true,display_select:1,color_select:1,config_hash:"",version:"",version_latest:"",msg:""};KM.www_rc.display_cameras[1]=["pad",0];KM.www_rc.display_cameras[2]=["pad",0,0,0];KM.www_rc.display_cameras[3]=["pad",0,0,0,0,0,0,0,0,0];KM.www_rc.display_cameras[4]=["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];KM.www_rc.display_cameras[5]=["pad",0,0,0,0,0,0];KM.www_rc.display_cameras[6]=["pad",0,0,0,0,0,0,0,0,0,0,0,0,0];KM.www_rc.display_cameras[7]=["pad",0,0,0,0,0,0,0,0];KM.www_rc.display_cameras[8]=["pad",0,0,0,0,0,0,0,0,0,0];KM.www_rc.display_cameras[9]=["pad",0,0];KM.www_rc.display_cameras[10]=["pad",0,0];KM.www_rc.display_cameras[11]=["pad",0,0];KM.www_rc.display_cameras[12]=["pad",0,0];KM.timeout_ids=function(){var b=[];for(var a=0;a<8;a++){b[a]=[]}return{add_id:function(c,d){b[c][b[c].length]=d},cull_ids:function(d){if(b[d].length>1){for(var c=0;c<b[d].length-1;c++){clearTimeout(b[d][c]);delete b[d][c]}b[d].length=1}},kill_ids:function(d){if(b[d].length>1){for(var c=0;c<b[d].length;c++){clearTimeout(b[d][c]);delete b[d][c]}b[d].length=1}}}};KM.timeout=KM.timeout_ids();KM.add_timeout_id=KM.timeout.add_id;KM.cull_timeout_ids=KM.timeout.cull_ids;KM.kill_timeout_ids=KM.timeout.kill_ids;KM.get_xmlHttp_obj=function(){var a=null;try{a=new XMLHttpRequest()}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}}return a};KM.load_settings=function(c){function a(h){var e=KM.get_xmlHttp_obj();var f=false;function g(){e.onreadystatechange=function(){if(e.readyState===4){e.onreadystatechange=null;var k=e.responseText;if(parseInt(k.substr(k.length-8),10)===k.length-13){f=true;KM.kill_timeout_ids(KM.GET_DATA);b(k,h)}}};e.open("GET","/cgi_bin/xmlHttp_settings_rd.py?rnd="+new Date().getTime(),true);e.send(null)}function d(){if(!f){g();KM.add_timeout_id(KM.GET_DATA,setTimeout(function(){d()},1500))}}d()}function b(e,n){KM.set_main_display_size();var o=navigator.userAgent.toLowerCase();KM.browser.browser_IE=o.search("msie")>-1;KM.browser.browser_FF=o.search("firefox")>-1;KM.browser.browser_OP=o.search("opera")>-1;KM.browser.browser_SP=(o.search("iphone")>-1||o.search("ipod")>-1||o.search("android")>-1||o.search("ipad")>-1||o.search("iemobile")>-1||o.search("blackberry")>-1);var k=e.split("$");var h,m,g;for(var f=1;f<k.length;f++){h=k[f].split(":");if(h[0].length>3){m=h[0].substring(0,3);g=parseInt(h[0].substring(3),10)}else{m=h[0];g=""}var l=h[1];switch(m){case"ine":KM.www_rc.interleave=(parseInt(l,10)===1);break;case"fse":KM.www_rc.full_screen=(parseInt(l,10)===1);break;case"lbe":KM.www_rc.low_bandwidth=(parseInt(l,10)===1);break;case"lce":KM.www_rc.low_cpu=(parseInt(l,10)===1);break;case"skf":KM.www_rc.skip_frames=(parseInt(l,10)===1);break;case"are":KM.www_rc.archive_button_enabled=(parseInt(l,10)===1);break;case"lge":KM.www_rc.logs_button_enabled=(parseInt(l,10)===1);break;case"coe":KM.www_rc.config_button_enabled=(parseInt(l,10)===1);break;case"fue":KM.www_rc.func_button_enabled=(parseInt(l,10)===1);break;case"spa":KM.www_rc.msg_button_enabled=(parseInt(l,10)===1);break;case"abe":KM.www_rc.about_button_enabled=(parseInt(l,10)===1);break;case"loe":KM.www_rc.logout_button_enabled=(parseInt(l,10)===1);break;case"fne":KM.www_rc.func_enabled[g]=(parseInt(l,10)===1);break;case"sec":KM.www_rc.secure=(parseInt(l,10)===1);break;case"coh":KM.www_rc.config_hash=l;break;case"fma":KM.www_rc.feed_mask[g]=l;break;case"fen":KM.www_rc.feed_enabled[g]=(parseInt(l,10)===1);break;case"fde":KM.www_rc.feed_device[g]=l;break;case"fin":KM.www_rc.feed_input[g]=parseInt(l,10);break;case"ful":KM.www_rc.feed_url[g]=KM.collapse_chars(l);break;case"fpr":KM.www_rc.feed_proxy[g]=KM.collapse_chars(l);break;case"fln":KM.www_rc.feed_lgn_name[g]=KM.collapse_chars(l);break;case"flp":KM.www_rc.feed_lgn_pw[g]=KM.collapse_chars(l);break;case"fwd":KM.www_rc.feed_width[g]=parseInt(l,10);break;case"fhe":KM.www_rc.feed_height[g]=parseInt(l,10);break;case"fna":KM.www_rc.feed_name[g]=KM.collapse_chars(l);break;case"fbo":KM.www_rc.feed_show_box[g]=(parseInt(l,10)===1);break;case"ffp":KM.www_rc.feed_fps[g]=parseInt(l,10);break;case"fqu":KM.www_rc.feed_quality[g]=parseInt(l,10);break;case"fkb":KM.www_rc.feed_kbs[g]=parseInt(l,10);break;case"fpe":KM.www_rc.feed_snap_enabled[g]=(parseInt(l,10)===1);break;case"fsn":KM.www_rc.feed_snap_interval[g]=parseInt(l,10);break;case"ffe":KM.www_rc.feed_smovie_enabled[g]=(parseInt(l,10)===1);break;case"fme":KM.www_rc.feed_movie_enabled[g]=(parseInt(l,10)===1);break;case"fup":KM.www_rc.feed_updates[g]=(parseInt(l,10)===1);break;case"psx":KM.www_rc.ptz_step_x[g]=parseInt(l,10);break;case"psy":KM.www_rc.ptz_step_y[g]=parseInt(l,10);break;case"ptt":KM.www_rc.ptz_track_type[g]=parseInt(l,10);break;case"pte":KM.www_rc.ptz_enabled[g]=(parseInt(l,10)===1);break;case"ptc":KM.www_rc.ptz_calib_first[g]=(parseInt(l,10)===1);break;case"pts":KM.www_rc.ptz_servo_settle[g]=parseFloat(l,10);break;case"ppe":KM.www_rc.ptz_park_enabled[g]=(parseInt(l,10)===1);break;case"ppd":KM.www_rc.ptz_park_delay[g]=parseInt(l,10);break;case"ppx":KM.www_rc.ptz_park_x[g]=parseInt(l,10);break;case"ppy":KM.www_rc.ptz_park_y[g]=parseInt(l,10);break;case"p1x":KM.www_rc.ptz_preset1_x[g]=parseInt(l,10);break;case"p1y":KM.www_rc.ptz_preset1_y[g]=parseInt(l,10);break;case"p2x":KM.www_rc.ptz_preset2_x[g]=parseInt(l,10);break;case"p2y":KM.www_rc.ptz_preset2_y[g]=parseInt(l,10);break;case"p3x":KM.www_rc.ptz_preset3_x[g]=parseInt(l,10);break;case"p3y":KM.www_rc.ptz_preset3_y[g]=parseInt(l,10);break;case"p4x":KM.www_rc.ptz_preset4_x[g]=parseInt(l,10);break;case"p4y":KM.www_rc.ptz_preset4_y[g]=parseInt(l,10);break;case"dif":var p=l.split(",");for(var d=0;d<p.length;d++){KM.www_rc.display_cameras[g][d+1]=parseInt(p[d],10)}break;case"col":KM.www_rc.color_select=parseInt(l,10);break;case"dis":KM.www_rc.display_select=parseInt(l,10);break;case"ver":KM.www_rc.version=l;document.getElementById("version_num").innerHTML="Ver "+l;break;case"vel":KM.www_rc.version_latest=l;break;case"msg":KM.www_rc.msg=KM.collapse_chars(l);break}}n()}a(c)};KM.set_main_display_size=function(){var b,a;if(typeof window.innerWidth!=="undefined"){b=window.innerWidth;a=window.innerHeight}else{if(typeof document.documentElement!=="undefined"&&typeof document.documentElement.clientWidth!=="undefined"&&document.documentElement.clientWidth!==0){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{b=document.getElementsByTagName("body")[0].clientWidth;a=document.getElementsByTagName("body")[0].clientHeight}}KM.browser.main_display_width=b-183;KM.browser.main_display_height=a-16};KM.exe_script=function(b,c){var a=KM.get_xmlHttp_obj();a.open("GET",b+"?val="+c+"&rnd="+new Date().getTime(),true);a.send(null)};KM.secs_hhmmss=function(c){var b=parseInt(c/(60*60),10);var d=parseInt((c-(b*60*60))/60,10);var a=parseInt(c-(b*60*60)-(d*60),10);return KM.pad_out2(b)+KM.pad_out2(d)+KM.pad_out2(a)};KM.secs_hh_mm_ss=function(c){var b=parseInt(c/(60*60),10);var d=parseInt((c-(b*60*60))/60,10);var a=parseInt(c-(b*60*60)-(d*60),10);return KM.pad_out2(b)+":"+KM.pad_out2(d)+":"+KM.pad_out2(a)};KM.expand_chars=function(a){a=a.replace(/&/g,"<amp>");a=a.replace(/\?/g,"<que>");a=a.replace(/:/g,"<col>");return a};KM.collapse_chars=function(a){a=a.replace(/<amp>/g,"&");a=a.replace(/<que>/g,"?");a=a.replace(/<col>/g,":");return a};KM.item_in_array=function(b,c){str_item=b.toString();for(var a=0;a<c.length;a++){if(c[a].toString()===str_item){return true}}return false};KM.pad_out=function(c,b){var a="00000000000000000000";if(String(c).length<b){c=a.substr(0,b-String(c).length)+String(c)}return String(c)};KM.pad_out2=function(a){return KM.pad_out(a,2)};KM.pad_out4=function(a){return KM.pad_out(a,4)};KM.pad_out6=function(a){return KM.pad_out(a,6)};KM.do_nothing=function(){};KM.enable_display_buttons=function(b){KM.cull_timeout_ids(KM.BUTTON_BAR);for(var a=1;a<13;a++){if(a===b){document.getElementById("d"+a).src="images/r"+a+".png"}else{document.getElementById("d"+a).src="images/b"+a+".png"}}KM.menu_bar_buttons.display_sec_enabled=true};KM.update_display_buttons=KM.enable_display_buttons;KM.disable_display_buttons=function(){for(var a=1;a<13;a++){document.getElementById("d"+a).src="images/g"+a+".png"}KM.menu_bar_buttons.display_sec_enabled=false};KM.enable_camera_buttons=function(){document.getElementById("camera_func_header").innerHTML="Camera Select";for(var a=1;a<17;a++){document.getElementById("ct"+a).innerHTML=a;document.getElementById("cb"+a).style.background="url(images/temp1.png) no-repeat bottom left";if(KM.www_rc.feed_enabled[a]){document.getElementById("ct"+a).style.color=KM.BLUE}else{document.getElementById("ct"+a).style.color=KM.GREY}}KM.menu_bar_buttons.camera_sec_enabled=true;KM.menu_bar_buttons.func_sec_enabled=false};KM.update_camera_buttons=KM.enable_camera_buttons;KM.disable_camera_buttons=function(){document.getElementById("camera_func_header").innerHTML="Camera Select";for(var a=1;a<17;a++){document.getElementById("cb"+a).style.background="url(images/temp1.png) no-repeat bottom left";document.getElementById("ct"+a).innerHTML=a;document.getElementById("ct"+a).style.color=KM.GREY}KM.menu_bar_buttons.camera_sec_enabled=false;KM.menu_bar_buttons.func_sec_enabled=false};KM.enable_func_buttons=function(){document.getElementById("camera_func_header").innerHTML="Function Select";for(var a=1;a<17;a++){document.getElementById("ct"+a).innerHTML="f"+a;document.getElementById("cb"+a).style.background="url(images/temp3.png) no-repeat bottom left";if(KM.www_rc.func_enabled[a]){document.getElementById("ct"+a).style.color=KM.BLUE}else{document.getElementById("ct"+a).style.color=KM.GREY}}KM.menu_bar_buttons.camera_sec_enabled=false;KM.menu_bar_buttons.func_sec_enabled=true};KM.update_func_buttons=KM.enable_func_buttons;KM.disable_func_buttons=KM.disable_camera_buttons;KM.blink_camera_func_button=function(a){if(KM.menu_bar_buttons.camera_sec_enabled){document.getElementById("ct"+a).style.color=KM.RED;KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.update_camera_buttons()},250))}else{if(KM.www_rc.func_enabled[a]){document.getElementById("ct"+a).style.color=KM.RED;KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.update_func_buttons()},250))}}};KM.enable_ptz_buttons=function(){if(KM.menu_bar_buttons.function_selected===1){KM.menu_bar_buttons.ptz_sec_enabled=false;if(KM.www_rc.ptz_enabled[KM.www_rc.display_cameras[1][1]]&&KM.www_rc.display_select===1){KM.live.ptz_feed=KM.www_rc.display_cameras[1][1];KM.menu_bar_buttons.ptz_sec_enabled=true}else{if(KM.www_rc.ptz_enabled[KM.live.last_camera_select]&&KM.live.last_camera_select!==0){KM.live.ptz_feed=KM.live.last_camera_select;KM.menu_bar_buttons.ptz_sec_enabled=true}}for(var a=1;a<5;a++){if(KM.menu_bar_buttons.ptz_sec_enabled){document.getElementById("p"+a).style.color=KM.BLUE}else{document.getElementById("p"+a).style.color=KM.GREY}}}};KM.update_ptz_buttons=KM.enable_ptz_buttons;KM.ptz_button_lockdown=function(a){KM.menu_bar_buttons.ptz_sec_enabled=false;document.getElementById("p"+a).style.color=KM.RED;KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.disable_ptz_buttons()},250))};KM.disable_ptz_buttons=function(){for(var a=1;a<5;a++){document.getElementById("p"+a).style.color=KM.GREY}KM.menu_bar_buttons.ptz_sec_enabled=false};KM.enable_function_buttons=function(b){var c=["pad","pad","archive_button_enabled","logs_button_enabled","config_button_enabled","func_button_enabled","about_button_enabled","msg_button_enabled","logout_button_enabled"];for(var a=1;a<c.length;a++){if(KM.www_rc[c[a]]||a===1){if(a===b){if(a===5){document.getElementById("fb5").style.background="url(images/temp4.png) no-repeat bottom left"}document.getElementById("ft"+a).style.color=KM.RED}else{if(a===5){document.getElementById("fb5").style.background="url(images/temp2.png) no-repeat bottom left"}document.getElementById("ft"+a).style.color=KM.BLUE}}else{document.getElementById("ft"+a).style.color=KM.GREY}}};KM.update_function_buttons=KM.enable_function_buttons;KM.display_button_clicked=function(a){if(KM.menu_bar_buttons.display_sec_enabled){KM.update_display_buttons(a);KM.www_rc.display_select=a;KM.live.last_camera_select=0;KM.update_ptz_buttons();if(KM.www_rc.full_screen){KM.display_live_full()}else{KM.display_live_normal()}}};KM.camera_func_button_clicked=function(a){if(KM.menu_bar_buttons.camera_sec_enabled||KM.menu_bar_buttons.func_sec_enabled){KM.blink_camera_func_button(a);if(KM.menu_bar_buttons.camera_sec_enabled){KM.live.last_camera_select=a;KM.update_ptz_buttons();if(KM.www_rc.display_select===1){KM.www_rc.display_cameras[1][1]=a;KM.live.last_camera_select=0;KM.update_ptz_buttons();if(KM.www_rc.full_screen){KM.display_live_full()}else{KM.display_live_normal()}}}else{KM.exe_script("/cgi_bin/xmlHttp_func.py",a)}}};KM.ptz_button_clicked=function(a){if(KM.menu_bar_buttons.ptz_sec_enabled){KM.ptz_button_lockdown(a);KM.exe_script("/cgi_bin/xmlHttp_ptz.py","crf"+KM.pad_out2(KM.live.ptz_feed)+"b"+KM.pad_out2(a)+"$")}};KM.function_button_clicked=function(a){if(KM.function_button_valid(a)){KM.update_function_buttons(a);KM.menu_bar_buttons.function_selected=a;switch(a){case 1:KM.enable_display_buttons(KM.www_rc.display_select);KM.enable_camera_buttons();KM.enable_ptz_buttons();if(KM.www_rc.full_screen){KM.display_live_full()}else{KM.display_live_normal()}break;case 2:KM.disable_display_buttons();KM.disable_camera_buttons();KM.disable_ptz_buttons();KM.display_archive();break;case 3:KM.disable_display_buttons();KM.disable_camera_buttons();KM.disable_ptz_buttons();KM.display_logs();break;case 4:KM.disable_display_buttons();KM.disable_camera_buttons();KM.disable_ptz_buttons();KM.display_config();break;case 5:KM.disable_display_buttons();KM.enable_func_buttons();KM.disable_ptz_buttons();break;case 6:KM.disable_display_buttons();KM.disable_camera_buttons();KM.disable_ptz_buttons();KM.display_about();break;case 7:KM.disable_display_buttons();KM.disable_camera_buttons();KM.disable_ptz_buttons();KM.display_msg();break;case 8:KM.disable_display_buttons();KM.disable_camera_buttons();KM.disable_ptz_buttons();KM.logout_button_clicked();break}}};KM.function_button_valid=function(a){var b=["pad","pad","archive_button_enabled","logs_button_enabled","pad","func_button_enabled","about_button_enabled","msg_button_enabled","logout_button_enabled"];return(a<2||a===4||KM.www_rc[b[a]])};KM.logout_button_clicked=function(){if(!window.confirm("Please confirm you wish to Logout")){KM.enable_select_buttons();KM.update_function_buttons(1);return}KM.session_id.current++;document.getElementById("whole_display").innerHTML='<div id="info_high_line"><div id="info_text"><span class="italic">kmotion</span> logout<br><span id="info_small_text">For security reasons please shut down your browser now.</span></div></div>';var c=document.getElementById("info_small_text");var d=193;function a(){var e=d.toString(16);c.style.color="#"+e+e+e;d+=2;if(d<255){setTimeout(a,20)}else{b()}}function b(){var e=d.toString(16);c.style.color="#"+e+e+e;d-=2;if(d>193){setTimeout(b,20)}else{setTimeout(a,400)}}setTimeout(a,2000)};KM.background_button_clicked=function(a){switch(a){case 1:document.body.style.backgroundImage="url(images/white.png)";break;case 2:document.body.style.backgroundImage="url(images/blue.png)";break;case 3:document.body.style.backgroundImage="url(images/green.png)";break;case 4:document.body.style.backgroundImage="url(images/yellow.png)";break;case 5:document.body.style.backgroundImage="url(images/red.png)";break}document.body.style.backgroundRepeat="repeat-x";KM.www_rc.color_select=a};KM.update_feeds=function(){var a=KM.get_xmlHttp_obj();a.onreadystatechange=function(){if(a.readyState===4){a.onreadystatechange=null;var c=a.responseText;KM.server.latest_jpegs=c.split("#");KM.server.servo_state=KM.server.latest_jpegs[17];if(KM.server.latest_jpegs[18]!==undefined){var b=KM.server.latest_jpegs[18].split("$");b.sort();KM.server.latest_events=b}}};a.open("GET","/cgi_bin/xmlHttp_feeds.py?rnd="+new Date().getTime(),true);a.send(null)};KM.feed_cache=function(m){var h=true;var b=false;var c=[];var g=0;var k=0;var n="";var e="";var a=0;var f=0;var l=0;for(var d=0;d<5;d++){c[d]=new Image()}return{get_jpeg:function(p,o){KM.cull_timeout_ids(KM.FEED_CACHE);g++;g=(g>4)?0:g;e=KM.server.latest_jpegs[m];if(e===""||e===undefined){KM.update_feeds();KM.add_timeout_id(KM.FEED_CACHE,setTimeout(function(){p("null",m,b,o)},1));return}if(n===e){KM.update_feeds();KM.add_timeout_id(KM.FEED_CACHE,setTimeout(function(){p(e,m,h,o)},100));return}n=e;c[g].onerror=function(){KM.add_timeout_id(KM.FEED_CACHE,setTimeout(function(){p("null",m,b,o)},1))};c[g].onload=function(){KM.kill_timeout_ids(KM.FEED_CACHE);var r=new Date();a=r.getTime();var q=0;if(l!==KM.server.servo_state){q=KM.www_rc.ptz_servo_settle[m]*1000+1;KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.enable_ptz_buttons()},q));KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.conf_ptz_ungrey_LUDR()},q));l=KM.server.servo_state}q=1;if(KM.www_rc.low_cpu){r=new Date().getTime();var s=(KM.browser.browser_SP)?(1000):(200);q=Math.max(s-(r-k),1);k=r}KM.add_timeout_id(KM.FEED_CACHE,setTimeout(function(){p(e,m,b,o)},q))};KM.update_feeds();c[g].src=e},check_jpeg_20sec_cache:function(){var o=new Date();var p=o.getTime()-a;if(p<20*1000&&e!==""&&e!==undefined){return e}else{return"null"}}}};KM.feed_cache_setup=function(){for(var a=1;a<17;a++){KM.server.feed_caches[a]=KM.feed_cache(a)}};KM.get_jpeg=function(b,c,a){KM.server.feed_caches[b].get_jpeg(c,a)};KM.check_jpeg_20sec_cache=function(a){return KM.server.feed_caches[a].check_jpeg_20sec_cache()};KM.init_display_grid=function(o){var b=3;var d=0;var e=0;var m=0;var c=0;var f="";var h=0;a();l(o);n();function a(){f="";h=0}function n(){document.getElementById("main_display").innerHTML=f}function g(E,r,H,O,J,v,p,C){h++;var L="images/gcam.png";var R="images/bcam.png";if(v===true){L="images/gcam_alt.png";R="images/bcam_alt.png"}if(typeof p==="undefined"){p=10}if(typeof C==="undefined"){C=10}var T=L;var D="No Video";var s=KM.WHITE;var x=KM.www_rc.display_cameras[E][h];if(KM.www_rc.feed_enabled[x]){T=R;var q=KM.check_jpeg_20sec_cache(x);if(q!=="null"){T=q}s=KM.BLUE;if(KM.item_in_array(x,KM.server.latest_events)){s=KM.RED}D=KM.www_rc.feed_name[x]}D=x+" : "+D;var S='<img id="image_'+h+'" ';var Q='style="position:absolute; ';var P="left:"+r+"px; ";var N="top:"+H+"px; ";var M="width:"+O+"px; ";var K="height:"+J+'px;" ';var I='src="'+T+'"; ';var G='onClick="KM.camera_jpeg_clicked('+h+')"; ';var F='alt="">';f=f+S+Q+P+N+M+K+I+G+F;var B='<span id="text_'+h+'"; ';var A='style="position:absolute; ';var z="left:"+(r+p)+"px; ";var y="top:"+(H+C)+"px;";var w="font-weight: bold;";var u="color:"+s+";";var t='">'+D+"</span>";f=f+B+A+z+y+w+u+t}function k(){var q=KM.browser.main_display_width-b*2;var p=KM.browser.main_display_height-b*2;if((q/p)<1.33){p=q*0.75}else{q=p*1.33}d=((KM.browser.main_display_width-q)/2);e=b;m=q;c=p}function l(w){k();var x,p,y,t,r,s,u,v;switch(w){case 1:y=1;t=1;u=(m-(b*(t-1)))/t;v=(c-(b*(y-1)))/y;for(x=0;x<y;x++){for(p=0;p<t;p++){g(w,d+(p*(u+b)),e+(x*(v+b)),u,v)}}break;case 2:y=2;t=2;u=(m-(b*(t-1)))/t;v=(c-(b*(y-1)))/y;for(x=0;x<y;x++){for(p=0;p<t;p++){g(w,d+(p*(u+b)),e+(x*(v+b)),u,v)}}break;case 3:y=3;t=3;u=(m-(b*(t-1)))/t;v=(c-(b*(y-1)))/y;for(x=0;x<y;x++){for(p=0;p<t;p++){g(w,d+(p*(u+b)),e+(x*(v+b)),u,v)}}break;case 4:y=4;t=4;u=(m-(b*(t-1)))/t;v=(c-(b*(y-1)))/y;for(x=0;x<y;x++){for(p=0;p<t;p++){g(w,d+(p*(u+b)),e+(x*(v+b)),u,v)}}break;case 5:y=[0,1,2,2,2];t=[2,2,0,1,2];u=(m-(b*2))/3;v=(c-(b*2))/3;g(w,d,e,(u*2)+b,(v*2)+b);for(var q=0;q<5;q++){x=y[q];p=t[q];g(w,d+(p*(u+b)),e+(x*(v+b)),u,v)}break;case 6:y=[0,0,1,1,2,2,2,2,3,3,3,3];t=[2,3,2,3,0,1,2,3,0,1,2,3];u=(m-(b*3))/4;v=(c-(b*3))/4;g(w,d,e,(u*2)+b,(v*2)+b);for(q=0;q<12;q++){x=y[q];p=t[q];g(w,d+(p*(u+b)),e+(x*(v+b)),u,v)}break;case 7:y=[0,1,2,3,3,3,3];t=[3,3,3,0,1,2,3];u=(m-(b*3))/4;v=(c-(b*3))/4;g(w,d,e,(u*3)+(b*2),(v*3)+(b*2));for(q=0;q<7;q++){x=y[q];p=t[q];g(w,d+(p*(u+b)),e+(x*(v+b)),u,v)}break;case 8:y=[0,0,1,1,2,2,3,3];t=[2,3,2,3,0,1,0,1];u=(m-(b*3))/4;v=(c-(b*3))/4;g(w,d,e,(u*2)+b,(v*2)+b);for(q=0;q<8;q++){x=y[q];p=t[q];g(w,d+(p*(u+b)),e+(x*(v+b)),u,v)}g(w,d+(u*2)+(b*2),e+(v*2)+(b*2),(u*2)+b,(v*2)+b);break;case 9:u=m;v=c;r=u*0.28;s=v*0.28;g(w,d,e,u,v,false,(u*0.02)+r+10,(v*0.02)+10);g(w,d+(u*0.02),e+(v*0.02),r,s,true);break;case 10:u=m;v=c;r=u*0.28;s=v*0.28;g(w,d,e,u,v,false,(u*0.02)+10,(v*0.02)+10);g(w,d+u-r-(u*0.02),e+(v*0.02),r,s,true);break;case 11:u=m;v=c;r=u*0.28;s=v*0.28;g(w,d,e,u,v,false,(u*0.02)+10,(v*0.02)+10);g(w,d+(u*0.02),e+v-s-(v*0.02),r,s,true);break;case 12:u=m;v=c;r=u*0.28;s=v*0.28;g(w,d,e,u,v,false,(u*0.02)+10,(v*0.02)+10);g(w,d+u-r-(u*0.02),e+v-s-(v*0.02),r,s,true);break}}};KM.initial_display_refresh=function(k,b){var f=[];var e=KM.www_rc.display_cameras[KM.www_rc.display_select].length;var g=0;KM.update_feeds();var h,a;for(var c=1;c<e;c++){h=KM.www_rc.display_cameras[KM.www_rc.display_select][c];a=KM.check_jpeg_20sec_cache(h);if(KM.www_rc.feed_enabled[h]&&a!=="null"){f[f.length]=h}}KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){l()},1));function l(){g++;if(g<e){var m=KM.www_rc.display_cameras[KM.www_rc.display_select][g];if(KM.www_rc.feed_enabled[m]&&!KM.item_in_array(m,f)){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(m,d,b)},1));return}KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){l()},1));return}KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){k(b)},1))}function d(m,o,p,n){if(n!==KM.session_id.current){return}KM.update_feeds();if(m!=="null"){document.getElementById("image_"+g).src=m}KM.text_refresh();KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){l()},1))}};KM.text_refresh=function(){var b=KM.www_rc.display_cameras[KM.www_rc.display_select].length;var a,c;for(i=1;i<b;i++){c=KM.WHITE;a=KM.www_rc.display_cameras[KM.www_rc.display_select][i];if(KM.www_rc.feed_enabled[a]){c=KM.BLUE;if(KM.item_in_array(a,KM.server.latest_events)){c=KM.RED}}document.getElementById("text_"+i).style.color=c}};KM.camera_jpeg_clicked=function(a){if(KM.live.last_camera_select!==0){KM.www_rc.display_cameras[KM.www_rc.display_select][a]=KM.live.last_camera_select;KM.live.last_camera_select=0}else{KM.www_rc.display_cameras[1][1]=KM.www_rc.display_cameras[KM.www_rc.display_select][a];KM.www_rc.display_select=1;KM.update_display_buttons(1);KM.update_ptz_buttons()}if(KM.www_rc.full_screen){KM.display_live_full()}else{KM.display_live_normal()}};KM.display_live_normal=function(){KM.session_id.current++;KM.set_main_display_size();KM.init_display_grid(KM.www_rc.display_select);var a=true;for(var c=1;c<KM.www_rc.display_cameras[KM.www_rc.display_select].length;c++){if(KM.www_rc.feed_enabled[KM.www_rc.display_cameras[KM.www_rc.display_select][c]]){a=false}}if(a){return}var d=b;KM.initial_display_refresh(d,KM.session_id.current);function b(h){var o=KM.www_rc.display_cameras[KM.www_rc.display_select].length;var f=new Date();var k=f.getTime();var l;var s=[];var t=1;var q=[];var p=0;var g=true;var n=["","","","",""];var r=0;m();function m(){while(h===KM.session_id.current){KM.kill_timeout_ids(KM.DISPLAY_LOOP);if(g||!KM.www_rc.interleave){if(KM.www_rc.low_bandwidth){f=new Date();if(f.getTime()-k<15*60*1000){KM.text_refresh();g=false;l=1000;if(KM.server.latest_events.length>1){l=1}KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){m()},l));return}}p++;if(p<o){var u=KM.www_rc.display_cameras[KM.www_rc.display_select][p];if(KM.www_rc.feed_enabled[u]&&(!KM.item_in_array(u,s)||!KM.www_rc.interleave)&&!KM.item_in_array(u,q)){g=false;q[q.length]=u;KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(u,e,h)},1));return}g=false;continue}p=0;q.length=0;f=new Date();k=f.getTime();continue}else{if(t<s.length){var u=s[t];t++;if(KM.item_in_array(u,KM.www_rc.display_cameras[KM.www_rc.display_select])){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(u,e,h)},1));return}else{continue}}s=KM.server.latest_events;t=1;g=true;continue}}}function e(u,x,y,w){if(w!==KM.session_id.current){return}if(u==="null"){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){m()},1));return}if(y){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){m()},1));return}r++;r=(r>4)?0:r;n[r]=u;for(var v=1;v<o;v++){if(KM.www_rc.display_cameras[KM.www_rc.display_select][v]===x){document.getElementById("image_"+v).src=n[r]}}KM.text_refresh();KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){m()},1))}}};KM.display_live_full=function(){KM.set_main_display_size();KM.session_id.current++;KM.init_display_grid(KM.www_rc.display_select);var b=true;for(var c=1;c<KM.www_rc.display_cameras[KM.www_rc.display_select].length;c++){if(KM.www_rc.feed_enabled[KM.www_rc.display_cameras[KM.www_rc.display_select][c]]){b=false}}if(b){return}var d=a;KM.initial_display_refresh(d,KM.session_id.current);function a(e){var o=KM.www_rc.display_cameras[KM.www_rc.display_select].length;var h=new Date();var t=h.getTime();var p=0;var g=[];var u=0;var l=e;var x=0;var q=[];var f=0;var s=["","","","",""];var v=0;y();function z(){KM.session_id.current++;l=KM.session_id.current;KM.enable_display_buttons(KM.www_rc.display_select);KM.enable_camera_buttons();KM.init_display_grid(KM.www_rc.display_select);var A=y;KM.initial_display_refresh(A,KM.session_id.current)}function y(){if(l!==KM.session_id.current){return}KM.kill_timeout_ids(KM.DISPLAY_LOOP);g=KM.server.latest_events;if(g.length>1){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){r()},1));return}if(KM.www_rc.low_bandwidth){h=new Date();if(h.getTime()-t<15*60*1000){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){y()},1000));return}}f++;if(f<o){var A=KM.www_rc.display_cameras[KM.www_rc.display_select][f];if(KM.www_rc.feed_enabled[A]&&!KM.item_in_array(A,q)){q[q.length]=A;KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(A,m,l)},1));return}KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){y()},1));return}f=0;q.length=0;h=new Date();t=h.getTime();KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){y()},1))}function m(A,D,E,C){if(C!==KM.session_id.current){return}KM.update_feeds();if(A==="null"){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){y()},1));return}if(E){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){y()},1));return}v++;v=(v>4)?0:v;s[v]=A;for(var B=1;B<o;B++){if(KM.www_rc.display_cameras[KM.www_rc.display_select][B]===D){document.getElementById("image_"+B).src=s[v]}}KM.text_refresh();KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){y()},1))}function r(){KM.session_id.current++;x=KM.session_id.current;KM.disable_display_buttons();KM.disable_camera_buttons();u=1;k(g[u]);h=new Date();p=h.getTime();KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){w()},1))}function w(){if(x!==KM.session_id.current){return}KM.kill_timeout_ids(KM.DISPLAY_LOOP);if(g.length===1){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){z()},1));return}h=new Date();if(h.getTime()-p>5*1000){p=h.getTime();u++}if(u<g.length){var A=g[u];KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(A,n,x)},1));return}g=KM.server.latest_events;u=1;KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){w()},1))}function n(A,C,E,B){if(B!==KM.session_id.current){return}if(A==="null"){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){w()},1));return}if(E){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){w()},200));return}v++;v=(v>4)?0:v;s[v]=A;document.getElementById("image_1").src=s[v];var D=KM.www_rc.feed_name[C];document.getElementById("text_1").innerHTML=C+" : "+D;KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){w()},1))}function k(F){var A=3;var L="";var aa=W;var W="images/bcam.png";var T=KM.browser.main_display_width-A*2;var G=KM.browser.main_display_height-A*2;if((T/G)<1.33){G=T*0.75}else{T=G*1.33}var M=((KM.browser.main_display_width-T)/2);var X=A;var Z=T;var B=G;var N=KM.www_rc.feed_name[F];N=F+" : "+N;var Y='<img id="image_1" ';var V='style="position:absolute; ';var U="left:"+M+"px; ";var S="top:"+X+"px; ";var R="width:"+Z+"px; ";var Q="height:"+B+'px;" ';var P='src="images/bcam.png";';var O='alt="">';L=L+Y+V+U+S+R+Q+P+O;var K='<span id="text_1"; ';var J='style="position:absolute; ';var I="left:"+(M+10)+"px; ";var H="top:"+(X+10)+"px;";var E="font-weight: bold;";var D="color:"+KM.RED;var C='">'+N+"</span>";L=L+K+J+I+H+E+D+C;document.getElementById("main_display").innerHTML=L}}};KM.display_archive_=function(){var aB=false;var J=false;var T=false;var k=[];var Z=[];var aF=[];var q=[];var X=[];var ag=[];var c=true;var s=true;var aE=false;var aC=0;var b=0;var ac=0;var N=[1,2,5,10];var ap=0;var m=[];var u=[];var af=[];var B=0;var I=0;var ak=0;var U=[];var aH=[];var ax=[];var am=[];var M=[];var at=0;var F=0;var p=[];var y=[];var a=-1;var t="";var an=0;var O=0;var Y=[new Image,new Image,new Image,new Image];var ah=0;var K=["","","",""];var W=0;function ad(){KM.session_id.current++;var aK=KM.session_id.current;KM.set_main_display_size();av();var aL=x;al(aL,aK)}function x(aK){if(k.length===0){html='<div class="archive_msg" style="text-align: center"><br><br>';html+="There are currently no recorded events or snapshots to display.<br><br>";html+="To enable event recording select either 'frame mode' or ";html+="'movie mode'<br>in the camera configuration ";html+="section and edit the motion mask.<br><br>";html+="To enable snapshot recording select 'snapshot mode' in the camera<br>";html+="configuration section</div>";document.getElementById("display_html").innerHTML=html}else{e();h();ar();v();document.getElementById("date_select").disabled=false;document.getElementById("camera_select").disabled=false;document.getElementById("view_select").disabled=false;document.getElementById("mode_select").disabled=false;var aL=aw;au(aL,k[document.getElementById("date_select").selectedIndex],Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],aK)}}function aw(){aI();E()}function E(){v();e();n();var aK=k[document.getElementById("date_select").selectedIndex];var aL=Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];aG(aK,aL);az()}function av(){O=KM.browser.main_display_width-6;an=KM.browser.main_display_height-6-151;if((O/an)<1.33){an=O*0.75}else{O=an*1.33}var aR=(KM.browser.main_display_width-O)/2;var aN=O/4;var aX=O/5;var aS="archive_title_FF";if(KM.browser.browser_OP){aS="archive_title_OP"}if(KM.browser.browser_IE){aS="archive_title_IE"}document.getElementById("main_display").innerHTML='<div id="'+aS+'" style="width:'+O+'px;"><span class="italic">kmotion</span>: Archive <span id="config_clock"> - </span></div><div class="divider"><img src="images/archive_divider.png" style="width:'+O+'px;" alt="" /></div><div id="config_bar" class="archive_bar"><form name="config" action="" onsubmit="return false"><select id="date_select" OnChange="KM.arch_change_date();" style="width:'+aN+'px;" disabled ><option>----/--/--</option></select><select id="camera_select" OnChange="KM.arch_change_camera();" style="width:'+aN+'px;" disabled><option>-:</option></select><select id="view_select" OnChange="KM.arch_change_view();" style="width:'+aN+'px;" disabled ><option>-</option></select><select id="mode_select" OnChange="KM.arch_change_mode();" style="width:'+aN+'px;" disabled ><option>Event mode</option><option>Display mode</option></select></form></div><div id="display_html" class="archive_backdrop" style="width:'+O+"px;height:"+an+'px;"></div><div class="archive_bar"><input type="button" id="bar_button1" style="width:'+aX+'px;" OnClick="KM.arch_bar_button_clicked(1);" value="-" disabled><input type="button" id="bar_button2" style="width:'+aX+'px;" OnClick="KM.arch_bar_button_clicked(2);" value="-" disabled><input type="button" id="bar_button3" style="width:'+aX+'px;" OnClick="KM.arch_bar_button_clicked(3);" value="-" disabled><input type="button" id="bar_button4" style="width:'+aX+'px;" OnClick="KM.arch_bar_button_clicked(4);" value="-" disabled><input type="button" id="bar_button5" style="width:'+aX+'px;" OnClick="KM.arch_bar_button_clicked(5);" value="-" disabled></div><div id="timeline" class="archive_timeline" style="width:'+O+'px;"></div>';var aP="";var aU=0,aT=0;var aM=0,aW=0,aV="";var aK=(24*60)/5;var aO=O/aK;var aL=0;for(var aQ=1;aQ<aK+1;aQ++){aU=Math.round(aQ*aO);aU=Math.min(O,aU);aL=aU-aT;aT=aU;aM=(aQ-1)*5;aW=parseInt(aM/60);aM=aM-(aW*60);aV=KM.pad_out2(aW)+":"+KM.pad_out2(aM);aP+='<img id="tslot_'+aQ+'" src="./images/tline_g0.png" style="width:'+aL+'px;height:30px;" onClick="KM.arch_tline_clicked('+((aQ-1)*5*60)+')" title="'+aV+'" alt="timeline">'}document.getElementById("timeline").innerHTML=aP;show_downloading_msg()}show_downloading_msg=function(){document.getElementById("display_html").innerHTML='<br><div class="archive_msg" style="text-align: center">... downloading data ...</div>'};function h(){var aK=document.getElementById("date_select");for(var aN=aK.options.length-1;aN>-1;aN--){aK.remove(aN)}var aO="",aL="";for(var aN=0;aN<k.length;aN++){aO=document.createElement("option");aL=k[aN];aO.text=aL.slice(0,4)+" / "+aL.slice(4,6)+" / "+aL.slice(6);try{aK.add(aO,null)}catch(aM){aK.add(aO)}new_obj=null;document.getElementById("date_select").selectedIndex=0}}function ar(){var aN=document.getElementById("camera_select");for(var aM=aN.options.length-1;aM>-1;aM--){aN.remove(aM)}var aK=document.getElementById("date_select").selectedIndex;var aO="";for(var aM=0;aM<Z[aK].length;aM++){aO=document.createElement("option");aO.text=KM.pad_out2(Z[aK][aM])+" : "+aF[aK][aM];try{aN.add(aO,null)}catch(aL){aN.add(aO)}new_obj=null;document.getElementById("camera_select").selectedIndex=0}}function aI(){var aK=Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];var aQ=document.getElementById("view_select");for(var aN=aQ.options.length-1;aN>-1;aN--){aQ.remove(aN)}var aM=q[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];var aO=X[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];var aP=ag[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];if(aM&&aO){if(ax[ax.length-1]>=u[u.length-1]){aM=false}else{aO=false}}var aR=[];aR[0]="No filter";if((aM||aO)&&aP){aR[1]="Filter event movies";aR[2]="Filter snapshots"}for(var aN=0;aN<aR.length;aN++){new_opt=document.createElement("option");new_opt.text=aR[aN];try{aQ.add(new_opt,null)}catch(aL){aQ.add(new_opt)}}new_obj=null;document.getElementById("view_select").selectedIndex=0;aB=aM;J=aO;T=aP}function az(){var aR=5*60;var aS=(5*60)/6;var aN=0,aK="";var aL=0;for(var aO=1;aO<289;aO++){aK="./images/tline_g0.png";if(T){if(aM((aO-1)*aR,aO*aR)){aK="./images/tline_b1.png"}}if(J){aL=0;aN=aP((aO-1)*aR,(aO*aR)-1);if(aN>aS*5){aL=6}else{if(aN>aS*4){aL=5}else{if(aN>aS*3){aL=4}else{if(aN>aS*2){aL=3}else{if(aN>aS){aL=2}else{if(aN>0){aL=1}}}}}}if(aL!==0){aK="./images/tline_r"+aL+".png"}}else{if(aB){aL=0;aN=aQ((aO-1)*aR,(aO*aR)-1);if(aN>aS*5){aL=6}else{if(aN>aS*4){aL=5}else{if(aN>aS*3){aL=4}else{if(aN>aS*2){aL=3}else{if(aN>aS){aL=2}else{if(aN>0){aL=1}}}}}}if(aL!==0){aK="./images/tline_r"+aL+".png"}}}document.getElementById("tslot_"+aO).src=aK}a=-1;function aM(a0,aZ){var aY=99999;var aX=-1;var aU=-1;for(var aT=p.length-1;aT>-1;aT--){if(y[aT]!==0){aU=aX;aX=aT}if(p[aT]<=a0){if(y[aT]===0){if(aX!==-1){aY=p[aX]}break}var aW=a0-p[aT];var aV=aW/y[aT];aV=parseInt(aV,10)+1;aY=p[aT]+parseInt(aV,10)*y[aT];if(p[Math.min(aT+1,p.length)]<=aY){aY=p[aU]}break}}if(aY===99999&&aX!==-1){aY=p[aX]}return aY<=aZ}function aQ(aW,aT){var aV=0;for(var aU=0;aU<m.length;aU++){if(m[aU]<=aT&&u[aU]>=aW){aV+=Math.min(u[aU],aT)-Math.max(m[aU],aW)}}return aV}function aP(aX,aT){var aW=0;var aV=0;for(var aU=0;aU<U.length;aU++){if(U[aU]<=aT&&ax[aU]>=aX){aW=Math.min(ax[aU],aT);aV+=aW-U[aU]}}return aV}}function aG(aL,aO){var aN="",aK="",aP=0;if(aB){var aR=aQ(m,u);for(var aM=0;aM<m.length;aM++){aK='onclick="KM.arch_event_clicked('+m[aM]+')"';aP=u[aM]-m[aM];if(KM.item_in_array(aP,aR)){aK+=' style="color:#D90000"'}aN+="<span "+aK+">";aN+="&nbsp;Movie event&nbsp;&nbsp;";aN+=KM.secs_hh_mm_ss(m[aM]);aN+="&nbsp;&nbsp;-&nbsp;&nbsp;";aN+=KM.secs_hh_mm_ss(u[aM]);aN+="&nbsp;&nbsp;duration&nbsp;&nbsp;";aN+=KM.pad_out4(aP);aN+="&nbsp;&nbsp;secs&nbsp;&nbsp ... &nbsp;&nbsp;click to view<br>";aN+="</span>"}}else{if(J){var aR=aQ(U,ax);for(var aM=0;aM<U.length;aM++){aK='onclick="KM.arch_event_clicked('+U[aM]+')"';aP=ax[aM]-U[aM];if(KM.item_in_array(aP,aR)){aK+=' style="color:#D90000"'}aN+="<span "+aK+">";aN+="&nbsp;Frame movie event&nbsp;&nbsp;";aN+=KM.secs_hh_mm_ss(U[aM]);aN+="&nbsp;&nbsp;-&nbsp;&nbsp;";aN+=KM.secs_hh_mm_ss(ax[aM]);aN+="&nbsp;&nbsp;duration&nbsp;&nbsp;";aN+=KM.pad_out4(aP);aN+="&nbsp;&nbsp;secs&nbsp;&nbsp ... &nbsp;&nbsp;click to view<br>";aN+="</span>"}}}if(aN.length===0){aN+='<div class="archive_msg" style="text-align: center"><br><br>';aN+="There are currently no recorded events to display.<br><br>";aN+="To enable event recording select either 'frame mode' or ";aN+="'movie mode'<br>in the camera configuration ";aN+="section and edit the motion mask.<br><br>To display ";aN+="snapshot images select 'Display mode'.</div>"}document.getElementById("display_html").innerHTML=aN;function aQ(aW,aS){var aV=[];for(var aU=0;aU<aW.length;aU++){aV[aU]=aS[aU]-aW[aU]}aV=aV.sort(function(aY,aX){return aY-aX});var aT=Math.max(1,parseInt(aV.length/10,10));return aV.splice(aV.length-aT,aT)}}function S(){KM.session_id.current++;var aK=KM.session_id.current;Q();show_downloading_msg();ar();var aL=aw;au(aL,k[document.getElementById("date_select").selectedIndex],Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],aK)}function V(){KM.session_id.current++;var aK=KM.session_id.current;Q();show_downloading_msg();v();var aL=aw;au(aL,k[document.getElementById("date_select").selectedIndex],Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],aK)}function r(){Q();show_downloading_msg();var aL=q[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];var aM=X[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];var aN=ag[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];if(aL&&aM){aL=false}var aK=document.getElementById("view_select").selectedIndex;aB=aL;J=aM;T=aN;if(aK===1){T=false}else{if(aK===2){aB=false;J=false}}E()}function aD(){if(document.getElementById("mode_select").selectedIndex===0){KM.session_id.current++;c=true;e();C();n();var aK=k[document.getElementById("date_select").selectedIndex];var aL=Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];aG(aK,aL)}else{c=false;s=true;ac=4;P();L(-1)}}function v(){c=true;document.getElementById("mode_select").selectedIndex=0}function ae(){c=false;document.getElementById("mode_select").selectedIndex=1}function D(aK){var aL=Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];var aN=aF[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];var aM=KM.secs_hh_mm_ss(aK);document.getElementById("config_clock").innerHTML="("+KM.pad_out2(aL)+":"+aN+" "+aM+")";aL=null;aN=null}function e(){var aK=Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];var aL=aF[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];document.getElementById("config_clock").innerHTML="("+KM.pad_out2(aK)+":"+aL+")";aK=null;aL=null}function n(){for(var aK=1;aK<6;aK++){document.getElementById("bar_button"+aK).disabled=true}document.getElementById("bar_button1").value="-";document.getElementById("bar_button2").value="-";document.getElementById("bar_button3").value="-";document.getElementById("bar_button4").value="-";document.getElementById("bar_button5").value="-"}function d(){for(var aK=1;aK<6;aK++){document.getElementById("bar_button"+aK).disabled=true}}function A(){for(var aK=1;aK<6;aK++){document.getElementById("bar_button"+aK).disabled=false}}function P(){for(var aL=1;aL<6;aL++){document.getElementById("bar_button"+aL).disabled=false}for(var aL=1;aL<6;aL++){document.getElementById("bar_button"+aL).style.color=KM.BLACK}var aK=[["<<<<","<",">",">>"],["<<<","<",">",">>"],["<<","<",">",">>"],["<<","<",">",">>"],["<<","<",">",">>"],["<<","<",">",">>"],["<<","<",">",">>>"],["<<","<",">",">>>>"]];var aM=aK[ac];document.getElementById("bar_button1").value=aM[0];document.getElementById("bar_button2").value=aM[1];document.getElementById("bar_button3").value="Click for frames";document.getElementById("bar_button4").value=aM[2];document.getElementById("bar_button5").value=aM[3];if(ac<3){document.getElementById("bar_button1").style.color=KM.RED}if(ac===3){document.getElementById("bar_button2").style.color=KM.RED}if(ac===4){document.getElementById("bar_button4").style.color=KM.RED}if(ac>4){document.getElementById("bar_button5").style.color=KM.RED}}function ao(){for(var aK=1;aK<6;aK++){document.getElementById("bar_button"+aK).disabled=false}for(var aK=1;aK<6;aK++){document.getElementById("bar_button"+aK).style.color=KM.BLACK}document.getElementById("bar_button1").value="-event";document.getElementById("bar_button2").value="-frame";document.getElementById("bar_button3").value="Click to play";document.getElementById("bar_button4").value="+frame";document.getElementById("bar_button5").value="+event"}function Q(){for(var aK=1;aK<289;aK++){document.getElementById("tslot_"+aK).src="./images/tline_g0.png"}}function aq(aK){var aL=parseInt(aK/(5*60))+1;if(aL!=a){if(a>-1){document.getElementById("tslot_"+a).src=t}a=aL;t=document.getElementById("tslot_"+aL).src;document.getElementById("tslot_"+aL).src="./images/tline_y6.png"}}function C(){if(a>-1){document.getElementById("tslot_"+a).src=t}}function G(aK){var aL=ac;if(s){if(aK===1){if(ac>2){ac=2}else{ac--;ac=Math.max(0,ac)}P()}else{if(aK===2){ac=3;P()}else{if(aK===3){KM.session_id.current++;s=false;ao()}else{if(aK===4){ac=4;P()}else{if(aK===5){if(ac<5){ac=5}else{ac++;ac=Math.min(7,ac)}P()}}}}}if(aL>3&&ac<4){ai()}if(aL<4&&ac>3){L()}}else{if(aK===1){f()}else{if(aK===2){ac=3;ai()}else{if(aK===3){s=true;ac=4;P();L()}else{if(aK===4){ac=4;L()}else{if(aK===5){o()}}}}}}}function aj(aK){KM.session_id.current++;ae();ac=4;s=true;P();L(aK)}event_clicked=aj;function L(aQ){KM.session_id.current++;var aL=KM.session_id.current;KM.kill_timeout_ids(KM.ARCH_LOOP);if(aQ!==undefined){aC=aQ;aq(aC);w("reset");aA(0,0,"reset");g();aE=true}var aK=k[document.getElementById("date_select").selectedIndex];var aP=Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];function aR(aZ){b=(new Date()).getTime();KM.kill_timeout_ids(KM.ARCH_LOOP);if(ac>3){if(KM.www_rc.skip_frames&&ac!==4){for(var aV=0;aV<aZ;aV++){var aY=z(aK,aP);if(aB){var aX=w();if(aX.valid&&((aX.secs<=aY.secs)||!T||!aY.valid)){aC=aX.secs;I=aX.frame;ak=aX.index;continue}}else{if(J){var aS=aA(aK,aP);if(aS.valid&&((aS.secs<=aY.secs)||!T||!aY.valid)){aC=aS.secs;at=aS.frame;F=aS.index;continue}}}break}}var aT=z(aK,aP);if(aB){var aU=w();if(aU.valid&&((aU.secs<=aT.secs)||!T||!aT.valid)){var a0=aN;if(aU.reset_html){aE=false;l(aU,aL,a0)}else{ab(aU,aL,a0)}return}}else{if(J){var aW=aA(aK,aP);if(aW.valid&&((aW.secs<=aT.secs)||!T||!aT.valid)){var a0=aO;display_smovie(aW,aL,a0);return}}}if(T&&aT.valid){if(!aE){g();aE=true}var a0=aM;aJ(aT,aL,a0);return}}}function aN(aV){if(aV.frames!==undefined){B=aV.frames}aC=aV.secs;I=aV.frame;ak=aV.index;D(aC);aq(aC);if(s){var aS=(new Date()).getTime()-b;var aU=(1000/af[ak])/N[ac-4];var aT=aU-aS;var aW=0;if(aT<0){aW=-aT/aU;aT=0}var aT=Math.max(0,((1000/af[ak])/N[ac-4])-aS);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aR(aW)},aT))}}function aO(aS){aC=aS.secs;at=aS.frame;F=aS.index;D(aC);aq(aC);if(s){var aT=(new Date()).getTime()-b;var aV=(1000/M[F])/N[ac-4];var aU=aV-aT;var aW=0;if(aU<0){aW=-aU/aV;aU=0}var aU=Math.max(0,((1000/M[F])/N[ac-4])-aT);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aR(aW)},aU))}}function aM(aU){aC=aU.secs;D(aC);aq(aC);if(s){var aS=(new Date()).getTime()-b;var aT=Math.max(0,(1000/N[ac-4])-aS);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aR(0)},aT))}}aR()}function w(aM){if(aM==="reset"){ak=-1}else{if(ak!==-1){var aN=I+1;if(aN<=B){var aL=Math.round(((aN/B)*(u[ak]-m[ak]))+m[ak]);return{valid:true,frame:aN,secs:aL,index:ak,reset_html:false}}else{ak=-1}}for(var aK=0;aK<m.length;aK++){if((m[aK]<=aC&&u[aK]>aC)||m[aK]>aC){return{valid:true,frame:1,secs:m[aK],index:aK,reset_html:true}}}return{valid:false,frame:0,secs:0,index:0,reset_html:false}}}function aA(aM,aP,aO){if(aO==="reset"){F=-1}else{if(F!==-1){var aQ=at+1;var aL=aC;if(aL===ax[F]&&aQ===am[F]){F=-1}else{if(aQ>=M[F]){aQ=0;aL++}return{valid:true,frame:aQ,secs:aL,index:F,fq_image_name:"/images_dbase/"+aM+"/"+KM.pad_out2(aP)+"/smovie/"+KM.secs_hhmmss(aL)+"/"+KM.pad_out2(aQ)+".jpg"}}}for(var aN=0;aN<U.length;aN++){if(U[aN]<=aC&&ax[aN]>aC){var aK=M[aN]-1;if(U[aN]===aC){aK=M[aN]-aH[aN]}return{valid:true,frame:M[aN]-aH[aN],secs:aC,index:aN,fq_image_name:"/images_dbase/"+aM+"/"+KM.pad_out2(aP)+"/smovie/"+KM.secs_hhmmss(aC)+"/"+KM.pad_out2(aK)+".jpg"}}else{if(U[aN]>aC){return{valid:true,frame:(M[aN]-aH[aN]),secs:U[aN],index:aN,fq_image_name:"/images_dbase/"+aM+"/"+KM.pad_out2(aP)+"/smovie/"+KM.secs_hhmmss(U[aN])+"/"+KM.pad_out2(M[aN]-aH[aN])+".jpg"}}}}return{valid:false,frame:0,secs:0,index:0,fq_image_name:""}}}function z(aK,aR){var aQ=99999;var aP=-1;var aM=-1;for(var aL=p.length-1;aL>-1;aL--){if(y[aL]!==0){aM=aP;aP=aL}if(p[aL]<=aC){if(y[aL]===0){if(aP!==-1){aQ=p[aP]}break}var aO=aC-p[aL];var aN=aO/y[aL];aN=parseInt(aN,10)+1;aQ=p[aL]+parseInt(aN,10)*y[aL];if(p[Math.min(aL+1,p.length)]<=aQ){aQ=p[aM]}break}}if(aQ===99999&&aP!==-1){aQ=p[aP]}if(aQ<=86400){return{valid:true,secs:aQ,fq_image_name:"/images_dbase/"+aK+"/"+KM.pad_out2(aR)+"/snap/"+KM.secs_hhmmss(aQ)+".jpg"}}else{return{valid:false,secs:0,fq_image_name:""}}}function o(){KM.session_id.current++;if(aB){for(var aK=0;aK<m.length;aK++){if(m[aK]>aC){L(m[aK]);break}}}else{if(J){for(var aK=0;aK<U.length;aK++){if(U[aK]>aC){L(U[aK]);break}}}}}function ai(aR){KM.session_id.current++;var aM=KM.session_id.current;KM.kill_timeout_ids(KM.ARCH_LOOP);if(aR!==undefined){aC=aR;aa("reset");H(0,0,"reset");g();aE=true}var aK=k[document.getElementById("date_select").selectedIndex];var aQ=Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];function aL(aY){b=(new Date()).getTime();KM.kill_timeout_ids(KM.ARCH_LOOP);if(ac<4){if(KM.www_rc.skip_frames&&ac!==3){for(var aV=0;aV<aY;aV++){var a0=R(aK,aQ);if(aB){var aX=aa();if(aX.valid&&((aX.secs>=a0.secs)||!T||!a0.valid)){aC=aX.secs;I=aX.frame;ak=aX.index;continue}}else{if(J){var aW=H(aK,aQ);if(aW.valid&&((aW.secs>=a0.secs)||!T||!a0.valid)){aC=aW.secs;at=aW.frame;F=aW.index;continue}}}break}}var aU=R(aK,aQ);if(aB){var aT=aa();if(aT.valid&&((aT.secs>=aU.secs)||!T||!aU.valid)){var aZ=aO;if(aT.reset_html){aE=false;l(aT,aM,aZ)}else{ab(aT,aM,aZ)}return}}else{if(J){var aS=H(aK,aQ);if(aS.valid&&((aS.secs>=aU.secs)||!T||!aU.valid)){var aZ=aP;display_smovie(aS,aM,aZ);return}}}if(T&&aU.valid){if(!aE){g();aE=true}var aZ=aN;aJ(aU,aM,aZ)}}}function aO(aW){if(aW.frames!==undefined){B=aW.frames}I=aW.frame;ak=aW.index;aC=aW.secs;D(aC);aq(aC);if(s){var aS=(new Date()).getTime()-b;var aU=(1000/af[ak])/N[3-ac];var aT=aU-aS;var aV=0;if(aT<0){aV=-aT/aU;aT=0}var aT=Math.max(0,((1000/af[ak])/N[3-ac])-aS);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aL(aV)},aT))}}function aP(aS){aC=aS.secs;at=aS.frame;F=aS.index;D(aC);aq(aC);if(s){var aT=(new Date()).getTime()-b;var aV=(1000/af[F])/N[3-ac];var aU=aV-aT;var aW=0;if(aU<0){aW=-aU/aV;aU=0}var aU=Math.max(0,((1000/M[F])/N[3-ac])-aT);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aL(aW)},aU))}}function aN(aT){aC=aT.secs;D(aC);aq(aC);if(s){var aS=(new Date()).getTime()-b;var aU=Math.max(0,(1000/N[3-ac])-aS);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aL()},aU))}}aL()}function aa(aM){if(aM==="reset"){ak=-1}else{if(ak!==-1){var aL=I-1;if(aL>0){var aN=Math.round(((aL/B)*(u[ak]-m[ak]))+m[ak]);return{valid:true,frame:aL,secs:aN,index:ak,reset_html:false}}else{ak=-1}}for(var aK=m.length;aK>-1;aK--){if((m[aK]<aC&&u[aK]>=aC)||u[aK]<aC){return{valid:true,frame:9999,secs:u[aK],index:aK,reset_html:true}}}return{valid:false,frame:0,secs:0,index:0,reset_html:false}}}function H(aL,aQ,aP){if(aP==="reset"){F=-1}else{if(F!==-1){var aO=at-1;var aN=aC;if(aN===U[F]&&aO===(M[F]-aH[F]-1)){F=-1}else{if(aO<0){aO=M[F]-1;aN--}return{valid:true,frame:aO,secs:aN,index:F,fq_image_name:"/images_dbase/"+aL+"/"+KM.pad_out2(aQ)+"/smovie/"+KM.secs_hhmmss(aN)+"/"+KM.pad_out2(aO)+".jpg"}}}for(var aM=U.length;aM>-1;aM--){if(U[aM]<aC&&ax[aM]>=aC){var aK=M[aM]-1;if(ax[aM]===aC){aK=am[aM]-1}return{valid:true,frame:aK,secs:aC,index:aM,fq_image_name:"/images_dbase/"+aL+"/"+KM.pad_out2(aQ)+"/smovie/"+KM.secs_hhmmss(aC)+"/"+KM.pad_out2(aK)+".jpg"}}else{if(ax[aM]<aC){return{valid:true,frame:(am[aM]-1),secs:ax[aM],index:aM,fq_image_name:"/images_dbase/"+aL+"/"+KM.pad_out2(aQ)+"/smovie/"+KM.secs_hhmmss(ax[aM])+"/"+(KM.pad_out2(am[aM]-1))+".jpg"}}}}return{valid:false,frame:0,secs:0,index:0,fq_image_name:""}}}function R(aL,aQ){var aP=99999;var aK=aC;for(var aM=p.length-1;aM>-1;aM--){if(p[aM]<aK){if(y[aM]===0){aK=Math.max(0,p[aM]-1);continue}var aO=aK-p[aM];var aN=aO/y[aM];if(parseInt(aN,10)===aN){aN=parseInt(aN,10)-1}else{aN=parseInt(aN,10)}var aP=p[aM]+aN*y[aM];break}}if(aP<=86400){return{valid:true,secs:aP,fq_image_name:"/images_dbase/"+aL+"/"+KM.pad_out2(aQ)+"/snap/"+KM.secs_hhmmss(aP)+".jpg"}}else{return{valid:false,secs:0,fq_image_name:""}}}function f(){KM.session_id.current++;if(aB){for(var aK=m.length;aK>-1;aK--){if(u[aK]<aC){L(m[aK]);break}}}else{if(J){for(var aK=U.length;aK>-1;aK--){if(ax[aK]<aC){L(U[aK]);break}}}}}function ab(aK,aL,aM){if(aL===KM.session_id.current){ap.GotoFrame(aK.frame);KM.cull_timeout_ids(KM.ARCH_LOOP);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aM(aK)},1))}}function l(aL,aN,aO){aM(aL,aN);if(aN===KM.session_id.current){d();aK(aL,aN,aO)}function aM(aR,aS){var aQ=k[document.getElementById("date_select").selectedIndex];var aT=Z[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];var aP="images_dbase/"+aQ+"/"+KM.pad_out2(aT)+"/movie/"+KM.secs_hhmmss(m[aR.index])+".swf";document.getElementById("display_html").innerHTML='<div id="movie"><div id="archive_flash_warn">Please enable a flash (.swf) compatible plugin.</div></div>';FlashReplace.replace("movie",aP,"movie_id",O-5,an-5);ap=document.getElementById("movie_id")}function aK(aQ,aR,aT){if(ap.PercentLoaded()===100){if(KM.browser.browser_IE){aQ.frames=ap.TotalFrames}else{aQ.frames=ap.TotalFrames()}if(aQ.secs===m[aQ.index]){ap.GotoFrame(1);aQ.frame=1}else{if(aQ.secs===u[aQ.index]){ap.GotoFrame(aQ.frames);aQ.frame=aQ.frames}else{var aS=aQ.secs-m[aQ.index];aQ.frame=parseInt(aQ.frames*((u[aQ.index]-m[aQ.index])/aS),10);ap.GotoFrame(aQ.frame)}}A();var aP=(1000/af[aQ.index])/N[ac-4];if(aR===KM.session_id.current){KM.cull_timeout_ids(KM.ARCH_LOOP);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aT(aQ)},aP))}}else{KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aK(aQ,aR,aT)},10))}}}function aJ(aN,aL,aO){var aM=aK;ay(aN.fq_image_name,aM);function aK(aP){if(aP){W++;W=(W>3)?0:W;K[W]=aN.fq_image_name;if(aL===KM.session_id.current){document.getElementById("image").src=K[W]}}if(aL===KM.session_id.current){KM.kill_timeout_ids(KM.ARCH_LOOP);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aO(aN)},1))}}}display_smovie=aJ;function g(){fq_image_name="/images/ncam.png";var aK="<img src="+fq_image_name+' id="image" style="width:100%;height:99%" alt="" />';document.getElementById("display_html").innerHTML=aK}function ay(aK,aL){ah++;ah=(ah>3)?0:ah;KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aL(false)},5000));Y[ah].onerror=function(){KM.kill_timeout_ids(KM.ARCH_LOOP);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aL(false)},1))};Y[ah].onload=function(){KM.kill_timeout_ids(KM.ARCH_LOOP);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aL(true)},1))};Y[ah].src=aK}function al(aP,aM){var aO=false;function aN(){var aQ=KM.get_xmlHttp_obj();aQ.onreadystatechange=function(){if(aQ.readyState===4){aQ.onreadystatechange=null;var aR=aQ.responseText;if(parseInt(aR.substr(aR.length-8),10)===aR.length-13&&KM.session_id.current===aM){aO=true;aL(aR)}}};aQ.open("GET","/cgi_bin/xmlHttp_arch.py?date=00000000&cam=0&func=avail&rnd="+new Date().getTime(),true);aQ.send(null)}function aK(){if(!aO){aN();KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aK()},2000))}}function aL(aR){k.length=0;Z.length=0;aF.length=0;q.length=0;X.length=0;ag.length=0;var aT=aR.split("$");for(i=0;i<aT.length-2;i++){var aS=aT[i+1].split("#");k[i]=aS[0];Z[i]=[];aF[i]=[];q[i]=[];X[i]=[];ag[i]=[];var aQ=0;for(j=1;j<aS.length-1;j=j+5){Z[i][aQ]=parseInt(aS[j],10);q[i][aQ]=(aS[j+1]==="1");X[i][aQ]=(aS[j+2]==="1");ag[i][aQ]=(aS[j+3]==="1");aF[i][aQ]=aS[j+4];aQ++}}k.reverse();Z.reverse();aF.reverse();q.reverse();X.reverse();ag.reverse();KM.kill_timeout_ids(KM.ARCH_LOOP);aP(aM)}aK()}function au(aR,aL,aO,aN){var aQ=false;function aP(){var aS=KM.get_xmlHttp_obj();aS.onreadystatechange=function(){if(aS.readyState===4){aS.onreadystatechange=null;var aT=aS.responseText;if(parseInt(aT.substr(aT.length-8),10)===aT.length-13&&KM.session_id.current===aN){aQ=true;aM(aT)}}};aS.open("GET","/cgi_bin/xmlHttp_arch.py?date="+aL+"&cam="+aO+"&func=index&rnd="+new Date().getTime(),true);aS.send(null)}function aK(){if(!aQ){aP();KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){aK()},2000))}}aK();function aM(aT){p.length=0;y.length=0;m.length=0;u.length=0;af.length=0;U.length=0;aH.length=0;ax.length=0;am.length=0;M.length=0;var aY=aT.split("@");var aV=aY[0].split("$");var aZ=aY[1].split("$");var aU=aY[2].split("$");for(var aW=0;aW<aV.length-1;aW++){var aX=aV[aW+1].split("#");m[aW]=aS(aX[0]);af[aW]=parseInt(aX[1],10);u[aW]=aS(aX[2])}for(var aW=0;aW<aZ.length-1;aW++){aX=aZ[aW+1].split("#");U[aW]=aS(aX[0]);aH[aW]=parseInt(aX[1],10);M[aW]=parseInt(aX[2],10);ax[aW]=aS(aX[3]);am[aW]=parseInt(aX[4],10)}for(var aW=0;aW<aU.length-2;aW++){aX=aU[aW+1].split("#");p[aW]=aS(aX[0]);y[aW]=parseInt(aX[1],10)}KM.kill_timeout_ids(KM.ARCH_LOOP);aR();function aS(a0){a0=KM.pad_out6(a0);hh=parseInt(a0.slice(0,2),10);mm=parseInt(a0.slice(2,4),10);ss=parseInt(a0.slice(4,6),10);return(hh*60*60)+(mm*60)+ss}}}return{init:ad,change_date:S,change_camera:V,change_view:r,change_mode:aD,bar_button_clicked:G,event_clicked:event_clicked,tline_clicked:aj}}();KM.display_archive=KM.display_archive_.init;KM.arch_change_date=KM.display_archive_.change_date;KM.arch_change_camera=KM.display_archive_.change_camera;KM.arch_change_view=KM.display_archive_.change_view;KM.arch_change_mode=KM.display_archive_.change_mode;KM.arch_bar_button_clicked=KM.display_archive_.bar_button_clicked;KM.arch_event_clicked=KM.display_archive_.event_clicked;KM.arch_tline_clicked=KM.display_archive_.tline_clicked;KM.display_logs=function(){KM.session_id.current++;var c=KM.session_id.current;var e="title_FF";if(KM.browser.browser_OP){e="title_OP"}if(KM.browser.browser_IE){e="title_IE"}document.getElementById("main_display").innerHTML='<div id="'+e+'"><span class="italic">kmotion</span>: Logs</div><div class="divider"><img src="images/divider_xl.png" alt="" /></div><div class="logs_backdrop" id="logs_html"><p style="text-align: center">... downloading data ...</p></div>';function d(m){var k=m.split("$");k.pop();var l="";for(var h=1;h<k.length;h++){if(k[h].indexOf("Incorrect")!==-1||k[h].indexOf("Deleting current")!==-1){l+='<span style="color:'+KM.RED+';">'+b(k[h])+"</span>"}else{if(k[h].indexOf("Deleting")!==-1||k[h].indexOf("Initial")!==-1){l+='<span style="color:'+KM.BLUE+';">'+b(k[h])+"</span>"}else{l+=b(k[h])}}}document.getElementById("logs_html").innerHTML=l}function b(h){event_split=h.split("#");return"Date : "+event_split[0]+"&nbsp;&nbsp;Time : "+event_split[1]+"&nbsp;&nbsp;Event : "+event_split[2]+"<br>"}var g=false;function f(){var h=KM.get_xmlHttp_obj();h.onreadystatechange=function(){if(h.readyState===4){h.onreadystatechange=null;var k=h.responseText;if(parseInt(k.substr(k.length-4),10)===k.length-8&&KM.session_id.current===c){g=true;KM.cull_timeout_ids(KM.LOGS);d(k)}}};h.open("GET","/cgi_bin/xmlHttp_logs.py?rnd="+new Date().getTime(),true);h.send(null)}function a(){if(!g){f();KM.add_timeout_id(KM.LOGS,setTimeout(function(){a()},1500))}}a()};KM.conf_config_track=function(){var e=false;var g=false;var f=false;var k=["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false];var a=["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false];var d=["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false];var l=["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false];var c=false;var b="";function h(m){if(m){return 1}return 0}return{misc_modified:function(){e=true},pw_modified:function(){f=true},display_modified:function(){g=true},feed_modified:function(m){a[m]=true;c=true},mask_modified:function(m){k[m]=true;c=true},ptz_en_tt_modified:function(m){l[m]=true;c=true},ptz_misc_modified:function(m){d[m]=true},reset:function(){e=false;f=false;k=["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false];a=["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false];d=["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false];l=["pad",false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false];g=false;c=false;b=""},sync:function(){if(e){b+="$ine:"+h(KM.www_rc.interleave);b+="$fse:"+h(KM.www_rc.full_screen);b+="$lbe:"+h(KM.www_rc.low_bandwidth);b+="$lce:"+h(KM.www_rc.low_cpu);b+="$skf:"+h(KM.www_rc.skip_frames);b+="$are:"+h(KM.www_rc.archive_button_enabled);b+="$lge:"+h(KM.www_rc.logs_button_enabled);b+="$coe:"+h(KM.www_rc.config_button_enabled);b+="$fue:"+h(KM.www_rc.func_button_enabled);b+="$spa:"+h(KM.www_rc.msg_button_enabled);b+="$abe:"+h(KM.www_rc.about_button_enabled);b+="$loe:"+h(KM.www_rc.logout_button_enabled);b+="$sec:"+h(KM.www_rc.secure)}if(f){b+="$coh:"+KM.www_rc.config_hash}for(var p=1;p<17;p++){if(k[p]===true){b+="$fma"+p+":"+KM.www_rc.feed_mask[KM.config.camera]}}for(var p=1;p<17;p++){if(a[p]===true){b+="$fen"+p+":"+h(KM.www_rc.feed_enabled[KM.config.camera]);b+="$fde"+p+":"+KM.www_rc.feed_device[KM.config.camera];b+="$fin"+p+":"+KM.www_rc.feed_input[KM.config.camera];b+="$ful"+p+":"+KM.expand_chars(KM.www_rc.feed_url[KM.config.camera]);b+="$fpr"+p+":"+KM.expand_chars(KM.www_rc.feed_proxy[KM.config.camera]);b+="$fln"+p+":"+KM.expand_chars(KM.www_rc.feed_lgn_name[KM.config.camera]);b+="$flp"+p+":"+KM.expand_chars(KM.www_rc.feed_lgn_pw[KM.config.camera]);b+="$fwd"+p+":"+KM.www_rc.feed_width[KM.config.camera];b+="$fhe"+p+":"+KM.www_rc.feed_height[KM.config.camera];b+="$fna"+p+":"+KM.expand_chars(KM.www_rc.feed_name[KM.config.camera]);b+="$fbo"+p+":"+h(KM.www_rc.feed_show_box[KM.config.camera]);b+="$ffp"+p+":"+KM.www_rc.feed_fps[KM.config.camera];b+="$fqu"+p+":"+KM.www_rc.feed_quality[KM.config.camera];b+="$fkb"+p+":"+KM.www_rc.feed_kbs[KM.config.camera];b+="$fpe"+p+":"+h(KM.www_rc.feed_snap_enabled[KM.config.camera]);b+="$fsn"+p+":"+KM.www_rc.feed_snap_interval[KM.config.camera];b+="$ffe"+p+":"+h(KM.www_rc.feed_smovie_enabled[KM.config.camera]);b+="$fme"+p+":"+h(KM.www_rc.feed_movie_enabled[KM.config.camera]);b+="$fup"+p+":"+h(KM.www_rc.feed_updates[KM.config.camera])}}if(g){for(var p=1;p<13;p++){b+="$dif"+p+":"+KM.www_rc.display_cameras[p].slice(1,KM.www_rc.display_cameras[p].length)}b+="$col:"+KM.www_rc.color_select;b+="$dis:"+KM.www_rc.display_select}for(var p=1;p<17;p++){if(l[p]===true){b+="$pte"+p+":"+h(KM.www_rc.ptz_enabled[p]);b+="$ptt"+p+":"+KM.www_rc.ptz_track_type[p]}}for(var p=1;p<17;p++){if(d[p]===true){b+="$psx"+p+":"+KM.www_rc.ptz_step_x[p];b+="$psy"+p+":"+KM.www_rc.ptz_step_y[p];b+="$ptc"+p+":"+h(KM.www_rc.ptz_calib_first[p]);b+="$pts"+p+":"+KM.www_rc.ptz_servo_settle[p];b+="$ppe"+p+":"+h(KM.www_rc.ptz_park_enabled[p]);b+="$ppd"+p+":"+KM.www_rc.ptz_park_delay[p];b+="$ppx"+p+":"+KM.www_rc.ptz_park_x[p];b+="$ppy"+p+":"+KM.www_rc.ptz_park_y[p];b+="$p1x"+p+":"+KM.www_rc.ptz_preset1_x[p];b+="$p1y"+p+":"+KM.www_rc.ptz_preset1_y[p];b+="$p2x"+p+":"+KM.www_rc.ptz_preset2_x[p];b+="$p2y"+p+":"+KM.www_rc.ptz_preset2_y[p];b+="$p3x"+p+":"+KM.www_rc.ptz_preset3_x[p];b+="$p3y"+p+":"+KM.www_rc.ptz_preset3_y[p];b+="$p4x"+p+":"+KM.www_rc.ptz_preset4_x[p];b+="$p4y"+p+":"+KM.www_rc.ptz_preset4_y[p]}}var o=b.length;var m="00000000".substring(0,8-(o+"").length);b+="$chk:"+m+o;if(o!==0){var n=KM.get_xmlHttp_obj();n.open("POST","/cgi_bin/xmlHttp_settings_wr.py");n.setRequestHeader("Content-type","application/x-www-form-urlencoded");n.setRequestHeader("Content-length",b.length);n.setRequestHeader("Connection","close");n.send("dblob="+b)}if(c){alert("The current synchronisation with the remote server\ninvolves reloading of the motion daemon configuration.\n\nDuring the reload kmotion will experience temporary\nvideo freezing.");KM.conf_config_track.reset()}}}}();KM.conf_error_daemon=function(a){KM.add_timeout_id(KM.ERROR_DAEMON,setTimeout(function(){b()},1));function c(){var d=KM.get_xmlHttp_obj();d.onreadystatechange=function(){if(d.readyState===4){d.onreadystatechange=null;var g=d.responseText;if(parseInt(g.substr(g.length-6),10)===g.length-10&&KM.session_id.current===a){KM.config.error_str=g.substr(0,g.length-10);var e=KM.config.error_str.split("\n");var h=false;for(var f=0;f<e.length;f++){if(e[f].search(KM.config.error_search_str)!==-1){h=true}}if(h){KM.conf_highlight_error_button()}else{KM.conf_disable_error_button()}}}};d.open("GET","/cgi_bin/xmlHttp_out.py?rnd="+new Date().getTime(),true);d.send(null)}function b(){c();if(KM.session_id.current===a){KM.cull_timeout_ids(KM.ERROR_DAEMON);KM.add_timeout_id(KM.ERROR_DAEMON,setTimeout(function(){b()},1000))}}};KM.display_config=function(){if(KM.www_rc.secure){KM.conf_loggin_html()}else{KM.conf_backdrop_html()}};KM.conf_loggin_html=function(){KM.session_id.current++;var a="title_FF";if(KM.browser.browser_OP){a="title_OP"}if(KM.browser.browser_IE){a="title_IE"}document.getElementById("main_display").innerHTML='<div id="'+a+'"><span class="italic">kmotion</span>: Config</div><div class="divider"><img src="images/divider_xl.png" alt="" /></div><br><form  name="login" onSubmit="return false"><div class="sub_title">Password <input type="password" name="password" size="20" />&nbsp;<input type="button" OnClick="KM.conf_login_validate_pw();" value="Submit"></div></form>';document.login.password.focus()};KM.conf_login_validate_pw=function(){if(KM.config_misc_hash_pw(document.login.password.value)===KM.www_rc.config_hash){KM.conf_backdrop_html()}else{document.login.password.value=""}};KM.conf_backdrop_html=function(){KM.session_id.current++;var c=197;var b="title_FF";if(KM.browser.browser_OP){b="title_OP"}if(KM.browser.browser_IE){b="title_IE"}var a="height:22px;";if(KM.browser.browser_FF){a=""}document.getElementById("main_display").innerHTML='<div id="'+b+'"><span class="italic">kmotion</span>: Config</div><div class="divider"><img src="images/divider_xl.png" alt="" /></div><div id="config_bar" class="config_bar"><form name="config" action="" onsubmit="return false"><select id="config_select" onchange="KM.conf_select_config();" onclick="KM.conf_select_config();" style="width:'+c+"px; "+a+'"><option>Misc Config</option><option>Camera 1</option><option>Camera 2</option><option>Camera 3</option><option>Camera 4</option><option>Camera 5</option><option>Camera 6</option><option>Camera 7</option><option>Camera 8</option><option>Camera 9</option><option>Camera 10</option><option>Camera 11</option><option>Camera 12</option><option>Camera 13</option><option>Camera 14</option><option>Camera 15</option><option>Camera 16</option></select><input type="button" value="PT(Z)" id="ptz_button" onclick="KM.conf_select_ptz()" style="width:'+c+"px; "+a+'" disabled /><input type="button" value="Motion Errors" id="error_button" onclick="KM.conf_select_errors();" style="width:'+c+"px; "+a+'" disabled/><input type="button" value="Server Load" onclick="KM.conf_select_load();" style="width:'+c+"px; "+a+'"/></form></div><div class="config_backdrop" id="config_html"></div>';KM.conf_misc_html()};KM.conf_highlight_error_button=function(){document.getElementById("error_button").style.fontWeight="bold";document.getElementById("error_button").style.color=KM.RED;document.getElementById("error_button").disabled=false};KM.conf_disable_error_button=function(){document.getElementById("error_button").style.fontWeight="normal";document.getElementById("error_button").style.color="#c6c7c9";document.getElementById("error_button").disabled=true};KM.conf_select_config=function(){KM.session_id.current++;KM.conf_error_daemon(KM.session_id.current);KM.config.camera=document.getElementById("config_select").selectedIndex;document.getElementById("ptz_button").disabled=true;if(KM.config.camera===0){KM.conf_misc_html()}else{KM.conf_feed_html(KM.config.camera)}};KM.conf_select_ptz=function(){KM.session_id.current++;KM.conf_error_daemon(KM.session_id.current);KM.conf_ptz_html()};KM.conf_select_errors=function(){KM.session_id.current++;KM.conf_error_daemon(KM.session_id.current);KM.conf_error_html()};KM.conf_select_load=function(){KM.session_id.current++;KM.conf_error_daemon(KM.session_id.current);KM.conf_load_html()};KM.conf_misc_html=function(){document.getElementById("config_html").innerHTML='<br><div class="config_button">Auto software check : <span id="misc_version"></span></div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box margin_top_4px"><input type="checkbox" id="misc_inter" onClick ="KM.conf_misc_highlight_apply();">Interleave mode. Gives preference to cameras where motion has been detected.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_full" onClick ="KM.conf_misc_force_inter();">Full screen mode. Changes to full screen mode when motion has been detected.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_low_bw" onClick ="KM.conf_misc_force_inter();">Low bandwidth mode. Update \'no motion\' cameras every 15 mins.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_low_cpu" onClick ="KM.conf_misc_highlight_apply();">Low CPU mode. Reduce browser CPU usage by capping update frequency.</div><br><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div style="float:left; width:45%;"><div class="margin_top_4px"><div class="config_tick_box"><input type="checkbox" id="misc_live" checked disabled>Live button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_logs" onClick ="KM.conf_misc_highlight_apply();">Logs button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_func" onClick ="KM.conf_misc_highlight_apply();">Func button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_msg" onClick ="KM.conf_misc_highlight_apply();">Msg button enabled.</div></div></div><div class="margin_top_4px"><div class="config_tick_box"><input type="checkbox" id="misc_archive" onClick ="KM.conf_misc_highlight_apply();">Archive button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_config" onClick ="KM.conf_misc_highlight_apply();">Config button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_about" onClick ="KM.conf_misc_highlight_apply();">About button enabled.&nbsp;</div><br><div class="config_tick_box"><input type="checkbox" id="misc_logout" onClick ="KM.conf_misc_highlight_apply();">Logout button enabled.</div></div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box margin_top_4px"><input type="checkbox" id="misc_skip_frames" onClick ="KM.conf_misc_highlight_apply();">Enable archive playback acceleration by skipping frames. (may miss events)</div><br><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box margin_top_4px"><input type="checkbox" id="misc_save" onClick ="KM.conf_misc_save_display();">Save the current \'Display Select\' configuration and current style as defaults.</div><br><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box margin_top_4px"><input type="checkbox" id="misc_secure" onClick ="KM.conf_misc_highlight_apply();">Enable security login screen. New password : <input type="password" id="misc_pw" size="20" >&nbsp;<input type="button" onclick="KM.conf_misc_save_pw();" value="Submit"> </div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_button margin_top_4px" id="conf_text"><input type="button" id="conf_apply" OnClick="KM.conf_misc_apply();" value="Apply"> all changes to the local browser configuration and sync with the remote server.</div>';if(KM.www_rc.low_bandwidth||KM.www_rc.full_screen){KM.www_rc.interleave=true;document.getElementById("misc_inter").checked=KM.www_rc.interleave;document.getElementById("misc_inter").disabled=true}document.getElementById("misc_inter").checked=KM.www_rc.interleave;document.getElementById("misc_full").checked=KM.www_rc.full_screen;document.getElementById("misc_low_bw").checked=KM.www_rc.low_bandwidth;document.getElementById("misc_low_cpu").checked=KM.www_rc.low_cpu;document.getElementById("misc_skip_frames").checked=KM.www_rc.skip_frames;document.getElementById("misc_archive").checked=KM.www_rc.archive_button_enabled;document.getElementById("misc_logs").checked=KM.www_rc.logs_button_enabled;document.getElementById("misc_config").checked=KM.www_rc.config_button_enabled;document.getElementById("misc_func").checked=KM.www_rc.func_button_enabled;document.getElementById("misc_msg").checked=KM.www_rc.msg_button_enabled;document.getElementById("misc_about").checked=KM.www_rc.about_button_enabled;document.getElementById("misc_logout").checked=KM.www_rc.logout_button_enabled;document.getElementById("misc_secure").checked=KM.www_rc.secure;if(KM.www_rc.version_latest==="failed_parse"){document.getElementById("misc_version").innerHTML="CONNECTING TO UPDATE SERVER ...";document.getElementById("misc_version").style.color=KM.YELLOW}else{if(KM.www_rc.version_latest==="SVN"){document.getElementById("misc_version").innerHTML="SVN VERSION - SVN UPDATE FOR LATEST BUILD";document.getElementById("misc_version").style.color=KM.RED}else{if(KM.www_rc.version===KM.www_rc.version_latest){document.getElementById("misc_version").innerHTML="NO UPDATES AVALIABLE."}else{document.getElementById("misc_version").innerHTML="VERSION "+KM.www_rc.version_latest+" IS NOW AVALIABLE FOR DOWNLOAD.";document.getElementById("misc_version").style.color=KM.RED}}}};KM.conf_misc_force_inter=function(){if(!document.getElementById("misc_low_bw").checked&&!document.getElementById("misc_full").checked){document.getElementById("misc_inter").disabled=false}else{document.getElementById("misc_inter").checked=KM.www_rc.interleave;document.getElementById("misc_inter").disabled=true}KM.conf_misc_highlight_apply()};KM.conf_misc_save_display=function(){KM.conf_config_track.display_modified();KM.conf_misc_highlight_apply()};KM.conf_misc_save_pw=function(){KM.config.pwd_changed=true;KM.conf_config_track.pw_modified();KM.conf_misc_highlight_apply()};KM.conf_misc_highlight_apply=function(){document.getElementById("conf_apply").style.fontWeight="bold";document.getElementById("conf_apply").style.color=KM.BLUE;document.getElementById("conf_text").style.color=KM.BLUE};KM.conf_misc_apply=function(){KM.www_rc.interleave=document.getElementById("misc_inter").checked;KM.www_rc.full_screen=document.getElementById("misc_full").checked;KM.www_rc.low_bandwidth=document.getElementById("misc_low_bw").checked;KM.www_rc.low_cpu=document.getElementById("misc_low_cpu").checked;KM.www_rc.skip_frames=document.getElementById("misc_skip_frames").checked;KM.www_rc.archive_button_enabled=document.getElementById("misc_archive").checked;KM.www_rc.logs_button_enabled=document.getElementById("misc_logs").checked;KM.www_rc.config_button_enabled=document.getElementById("misc_config").checked;KM.www_rc.func_button_enabled=document.getElementById("misc_func").checked;KM.www_rc.msg_button_enabled=document.getElementById("misc_msg").checked;KM.www_rc.about_button_enabled=document.getElementById("misc_about").checked;KM.www_rc.logout_button_enabled=document.getElementById("misc_logout").checked;KM.www_rc.secure=document.getElementById("misc_secure").checked;if(KM.config.pwd_changed){KM.www_rc.config_hash=KM.config_misc_hash_pw(document.getElementById("misc_pw").value);KM.config.pwd_changed=false}document.getElementById("misc_save").checked=false;document.getElementById("conf_apply").style.fontWeight="normal";document.getElementById("conf_apply").style.color=KM.BLACK;document.getElementById("conf_text").style.color=KM.DARK_GREY;KM.update_function_buttons(4);KM.conf_config_track.misc_modified();KM.conf_config_track.sync()};KM.config_misc_hash_pw=function(c){var b="";for(var a=0;a<c.length;a++){b+=c.charCodeAt(a)}return b};KM.conf_feed_html=function(l){var p=340;var b=250;var q="";var k=p/10;var c=b/10;var a="";for(var h=1;h<101;h++){a+='<div id="mask_'+h+'" style="position:absolute; left:10px; top:10px;"><img id="mask_img_'+h+'" style="width:'+k+"px; height:"+c+'px;"onclick="KM.conf_toggle_feed_mask('+h+');" src="images/mask_trans.png" alt=""></div>'}a+='<br><div style="float:left; width:360px;"><div class="margin_left_20px"><img id="image" style="width: '+p+"px; height: "+b+'px;" src="images/gcam.png" alt=""> </div></div><div class="config_tick_box"><input type="checkbox" id="feed_enabled" onclick="KM.conf_feed_enabled();">Enable camera</div><div class="divider"><img src="images/config_divider.png" alt="" ></div><div style="float:left; width:75px;" class="config_text disabled margin_top_4px" id="feed_text_1"><span class="margin_top_3px">Device&nbsp;:</span><br><div class="margin_top_3px"></div>URL&nbsp;:<br><div class="margin_top_3px"></div>Name&nbsp;:<br><div class="margin_top_3px"></div>Width&nbsp;:<br></div><div style="float:left; width:110px;" class="config_text_basic margin_top_4px"><select id="feed_device" onchange="KM.conf_feed_net_highlight();" disabled><option value="0">/dev/video0</option><option value="1">/dev/video1</option><option value="2">/dev/video2</option><option value="3">/dev/video3</option><option value="4">/dev/video4</option><option value="5">/dev/video5</option><option value="6">/dev/video6</option><option value="7">/dev/video7</option><option value="8">/dev/video8</option><option value="9">/dev/video9</option><option value="10">/dev/video10</option><option value="11">/dev/video11</option><option value="12">/dev/video12</option><option value="13">/dev/video13</option><option value="14">/dev/video14</option><option value="15">/dev/video15&nbsp;</option><option value="URL http://">Network Cam</option></select><input type="text" id="feed_url" style="width: 120px; height: 15px;" onfocus="KM.conf_feed_highlight_apply();" disabled><input type="text" id="feed_lgn_name" style="width: 120px; height: 15px;" onfocus="KM.conf_feed_highlight_apply();" disabled><input type="text" id="feed_width" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled> px</div><div style="float:left; width:75px;" class="config_text disabled margin_top_4px" id="feed_text_2">Input&nbsp;:<br><div class="margin_top_3px"></div>Proxy&nbsp;:<br><div class="margin_top_3px"></div>Pass&nbsp;:<br><div class="margin_top_3px"></div>Height&nbsp;:<br></div><div style="float:left; width:100px;" class="config_text_basic margin_top_4px"><select id="feed_input" onchange="KM.conf_feed_highlight_apply();" disabled><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">-&nbsp;&nbsp;</option></select><br><input type="text" id="feed_proxy" style="width: 120px; height: 15px;" onfocus="KM.conf_feed_highlight_apply();" disabled><input type="password" id="feed_lgn_pw" style="width: 120px; height: 15px;" onfocus="KM.conf_feed_highlight_apply();" disabled><input type="text" id="feed_height" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled> px</div><div class="divider"><img src="images/config_divider.png" alt="" ></div><div class="config_button disabled margin_top_4px" id="feed_text_3"> Camera name : " '+l+' : <input type="text" id="feed_name" size="15" onfocus="KM.conf_feed_highlight_apply();" disabled> "</div><div class="divider"><img src="images/config_divider.png" alt="" ></div><div class="config_tick_box disabled margin_top_4px" id="feed_text_4"><input type="checkbox" id="feed_box" onclick="KM.conf_feed_highlight_apply();" disabled>Enable motion highlighting (Draw box)</div><div class="divider"><img src="images/config_divider.png" alt="" ></div><div class="config_button disabled margin_top_4px" id="feed_text_5">Click on the image to edit the motion mask.</div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_button disabled margin_top_4px" id="feed_text_6">Record : <input type="text" id="feed_fps" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled> fps, &nbsp;&nbsp;Image (frame & snap) quality : <input type="text" id="feed_quality" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled> %, &nbsp;&nbsp;Movie quality : <input type="text" id="feed_kbs" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled> kbs</div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box disabled margin_top_4px" id="feed_text_7"><input type="checkbox" id="feed_frame_enabled" onclick="KM.conf_feed_frame_selected();" disabled>Enable frame mode. Record motion events as a series of discrete frames.</div><div class="config_tick_box disabled margin_top_4px" id="feed_text_8"><input type="checkbox" id="feed_ffmpeg_enabled" onclick="KM.conf_feed_ffmpeg_selected();" disabled>Enable movie mode. Record motion events as a (flash swf) movie.</div><div class="config_tick_box disabled margin_top_4px" id="feed_text_9"><input type="checkbox" id="feed_updates" onclick="KM.conf_feed_highlight_apply();" disabled>Enable additional live image updates. May increases server load.</div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box disabled margin_top_4px" id="feed_text_10"><input type="checkbox" id="feed_snap_enabled" onclick="KM.conf_feed_highlight_apply();" disabled>Enable snapshot mode. Record an image in time lapse mode with a pause between images<br>&nbsp;of : <input type="text" id="feed_snap" size="6" onfocus="KM.conf_feed_highlight_apply();" disabled> Seconds (300 Seconds recommended)</div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_button margin_top_4px" id="feed_text_11"><input type="button" id="feed_apply" OnClick="KM.conf_feed_apply();" value="Apply"> all changes to the local browser configuration and sync with the remote server.</div>';if(KM.www_rc.feed_enabled[KM.config.camera]){a=a.replace(/disabled/g,"");a=a.replace(/gcam.png/,"bcam.png");KM.conf_live_feed_daemon(KM.session_id.current,KM.config.camera)}document.getElementById("config_html").innerHTML=a;if(KM.www_rc.feed_enabled[KM.config.camera]){if(KM.www_rc.feed_device[KM.config.camera]==16){document.getElementById("feed_input").disabled=true;document.getElementById("feed_url").disabled=false;document.getElementById("feed_proxy").disabled=false;document.getElementById("feed_lgn_name").disabled=false;document.getElementById("feed_lgn_pw").disabled=false}else{document.getElementById("feed_input").disabled=false;document.getElementById("feed_url").disabled=true;document.getElementById("feed_proxy").disabled=true;document.getElementById("feed_lgn_name").disabled=true;document.getElementById("feed_lgn_pw").disabled=true}}document.getElementById("feed_enabled").checked=KM.www_rc.feed_enabled[KM.config.camera];document.getElementById("feed_device").selectedIndex=KM.www_rc.feed_device[KM.config.camera];document.getElementById("feed_input").selectedIndex=KM.www_rc.feed_input[KM.config.camera];document.getElementById("feed_url").value=KM.www_rc.feed_url[KM.config.camera];document.getElementById("feed_proxy").value=KM.www_rc.feed_proxy[KM.config.camera];document.getElementById("feed_lgn_name").value=KM.www_rc.feed_lgn_name[KM.config.camera];document.getElementById("feed_lgn_pw").value=KM.www_rc.feed_lgn_pw[KM.config.camera];document.getElementById("feed_width").value=KM.www_rc.feed_width[KM.config.camera];document.getElementById("feed_height").value=KM.www_rc.feed_height[KM.config.camera];document.getElementById("feed_name").value=KM.www_rc.feed_name[KM.config.camera];document.getElementById("feed_box").checked=KM.www_rc.feed_show_box[KM.config.camera];document.getElementById("feed_fps").value=KM.www_rc.feed_fps[KM.config.camera];document.getElementById("feed_quality").value=KM.www_rc.feed_quality[KM.config.camera];document.getElementById("feed_kbs").value=KM.www_rc.feed_kbs[KM.config.camera];document.getElementById("feed_snap_enabled").checked=KM.www_rc.feed_snap_enabled[KM.config.camera];document.getElementById("feed_snap").value=KM.www_rc.feed_snap_interval[KM.config.camera];document.getElementById("feed_frame_enabled").checked=KM.www_rc.feed_smovie_enabled[KM.config.camera];document.getElementById("feed_ffmpeg_enabled").checked=KM.www_rc.feed_movie_enabled[KM.config.camera];document.getElementById("feed_updates").checked=KM.www_rc.feed_updates[KM.config.camera];var f=document.getElementById("image").offsetTop;var g=document.getElementById("image").offsetLeft;var d=0;if(KM.browser.browser_OP){d=-2}if(KM.browser.browser_IE){d=-2}g+=d;f+=d;var o=0;for(var m=0;m<10;m++){for(var n=0;n<10;n++){o=n+1+(m*10);document.getElementById("mask_"+o).style.top=(f+(c*m))+"px";document.getElementById("mask_"+o).style.left=(g+(k*n))+"px"}}KM.config.mask="";var e=KM.www_rc.feed_mask[KM.config.camera].split("#");for(var h=0;h<10;h++){KM.config.mask+=KM.pad_out(parseInt(e[h],16).toString(2),10)}if(KM.www_rc.feed_enabled[KM.config.camera]){for(var h=0;h<100;h++){if(KM.config.mask.charAt(h)==="1"){document.getElementById("mask_img_"+(h+1)).src="images/mask.png"}}document.getElementById("ptz_button").disabled=false}};KM.conf_feed_enabled=function(){KM.conf_feed_highlight_apply();if(document.getElementById("feed_enabled").checked){KM.conf_feed_ungrey()}else{KM.conf_feed_grey()}KM.conf_config_track.mask_modified(KM.config.camera)};KM.conf_toggle_feed_mask=function(a){if(KM.config.mask.charAt(a-1)==="0"&&document.getElementById("feed_enabled").checked){document.getElementById("mask_img_"+a).src="images/mask.png";KM.config.mask=KM.config.mask.substr(0,a-1)+"1"+KM.config.mask.substr(a)}else{document.getElementById("mask_img_"+a).src="images/mask_trans.png";KM.config.mask=KM.config.mask.substr(0,a-1)+"0"+KM.config.mask.substr(a)}KM.conf_config_track.mask_modified(KM.config.camera);KM.conf_feed_highlight_apply()};KM.conf_feed_net_highlight=function(){if(document.getElementById("feed_device").selectedIndex==16){document.getElementById("feed_input").disabled=true;document.getElementById("feed_url").disabled=false;document.getElementById("feed_proxy").disabled=false;document.getElementById("feed_lgn_name").disabled=false;document.getElementById("feed_lgn_pw").disabled=false}else{document.getElementById("feed_input").disabled=false;document.getElementById("feed_url").disabled=true;document.getElementById("feed_proxy").disabled=true;document.getElementById("feed_lgn_name").disabled=true;document.getElementById("feed_lgn_pw").disabled=true;KM.conf_feed_highlight_apply()}};KM.conf_feed_frame_selected=function(){document.getElementById("feed_ffmpeg_enabled").checked=false;KM.conf_feed_highlight_apply()};KM.conf_feed_ffmpeg_selected=function(){document.getElementById("feed_frame_enabled").checked=false;KM.conf_feed_highlight_apply()};KM.conf_feed_grey=function(){KM.session_id.current++;KM.conf_error_daemon(KM.session_id.current);var b=["feed_device","feed_input","feed_url","feed_proxy","feed_lgn_name","feed_lgn_pw","feed_width","feed_height","feed_name","feed_box","feed_fps","feed_quality","feed_kbs","feed_snap_enabled","feed_snap","feed_frame_enabled","feed_ffmpeg_enabled","feed_updates"];for(var a=0;a<b.length;a++){document.getElementById(b[a]).disabled=true}for(var a=1;a<11;a++){document.getElementById("feed_text_"+a).style.color=KM.GHOST}for(var a=0;a<100;a++){document.getElementById("mask_img_"+(a+1)).src="images/mask_trans.png"}document.getElementById("image").src="images/gcam.png"};KM.conf_feed_ungrey=function(){KM.conf_live_feed_daemon(KM.session_id.current,KM.config.camera);var b=["feed_device","feed_input","feed_url","feed_proxy","feed_lgn_name","feed_lgn_pw","feed_width","feed_height","feed_name","feed_box","feed_fps","feed_quality","feed_kbs","feed_snap_enabled","feed_snap","feed_frame_enabled","feed_ffmpeg_enabled","feed_updates"];for(var a=0;a<b.length;a++){document.getElementById(b[a]).disabled=false}for(var a=1;a<11;a++){document.getElementById("feed_text_"+a).style.color=KM.DARK_GREY}KM.conf_feed_net_highlight();document.getElementById("image").src="images/bcam.png";for(var a=0;a<100;a++){if(KM.config.mask.charAt(a)==="1"){document.getElementById("mask_img_"+(a+1)).src="images/mask.png"}}};KM.conf_feed_highlight_apply=function(){document.getElementById("feed_apply").style.fontWeight="bold";document.getElementById("feed_apply").style.color=KM.BLUE;document.getElementById("feed_text_11").style.color=KM.BLUE};KM.conf_feed_apply=function(){KM.www_rc.feed_enabled[KM.config.camera]=document.getElementById("feed_enabled").checked;KM.www_rc.feed_device[KM.config.camera]=document.getElementById("feed_device").selectedIndex;KM.www_rc.feed_input[KM.config.camera]=document.getElementById("feed_input").selectedIndex;KM.www_rc.feed_url[KM.config.camera]=document.getElementById("feed_url").value;KM.www_rc.feed_proxy[KM.config.camera]=document.getElementById("feed_proxy").value;KM.www_rc.feed_lgn_name[KM.config.camera]=document.getElementById("feed_lgn_name").value;KM.www_rc.feed_lgn_pw[KM.config.camera]=document.getElementById("feed_lgn_pw").value;KM.www_rc.feed_name[KM.config.camera]=document.getElementById("feed_name").value;KM.www_rc.feed_show_box[KM.config.camera]=document.getElementById("feed_box").checked;KM.www_rc.feed_snap_enabled[KM.config.camera]=document.getElementById("feed_snap_enabled").checked;KM.www_rc.feed_smovie_enabled[KM.config.camera]=document.getElementById("feed_frame_enabled").checked;KM.www_rc.feed_movie_enabled[KM.config.camera]=document.getElementById("feed_ffmpeg_enabled").checked;KM.www_rc.feed_updates[KM.config.camera]=document.getElementById("feed_updates").checked;var e="";KM.www_rc.feed_mask[KM.config.camera]="";for(var d=0;d<10;d++){e=KM.config.mask.substr(d*10,10);KM.www_rc.feed_mask[KM.config.camera]+=parseInt(e,2).toString(16)+"#"}var f=parseInt(document.getElementById("feed_width").value,10);if(isNaN(f)){f=0}f=parseInt(f/16)*16;if(KM.www_rc.feed_width[KM.config.camera]!==f){KM.conf_config_track.mask_modified(KM.config.camera);KM.www_rc.feed_width[KM.config.camera]=f}document.getElementById("feed_width").value=f;var b=parseInt(document.getElementById("feed_height").value,10);if(isNaN(b)){b=0}b=parseInt(b/16)*16;if(KM.www_rc.feed_height[KM.config.camera]!==b){KM.conf_config_track.mask_modified(KM.config.camera);KM.www_rc.feed_height[KM.config.camera]=b}document.getElementById("feed_height").value=b;var g=parseInt(document.getElementById("feed_fps").value,10);if(isNaN(g)){g=0}KM.www_rc.feed_fps[KM.config.camera]=g;document.getElementById("feed_fps").value=g;var h=parseInt(document.getElementById("feed_quality").value,10);if(isNaN(h)){h=10}h=Math.max(10,h);h=Math.min(100,h);KM.www_rc.feed_quality[KM.config.camera]=h;document.getElementById("feed_quality").value=h;var c=parseInt(document.getElementById("feed_kbs").value,10);if(isNaN(c)){c=0}KM.www_rc.feed_kbs[KM.config.camera]=c;document.getElementById("feed_kbs").value=c;var a=parseInt(document.getElementById("feed_snap").value,10);if(isNaN(a)){a=0}KM.www_rc.feed_snap_interval[KM.config.camera]=a;document.getElementById("feed_snap").value=a;if(KM.www_rc.feed_enabled[KM.config.camera]){document.getElementById("ptz_button").disabled=false}else{document.getElementById("ptz_button").disabled=true}document.getElementById("feed_apply").style.fontWeight="normal";document.getElementById("feed_apply").style.color=KM.BLACK;document.getElementById("feed_text_11").style.color=KM.DARK_GREY;KM.conf_config_track.feed_modified(KM.config.camera);KM.conf_config_track.sync()};KM.conf_live_feed_daemon=function(b,g){var a=b;var d=g;var h=0;var e=["","","","",""];var k=0;KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout(function(){f()},1));function f(){if(a===KM.session_id.current){h=(new Date()).getTime();KM.kill_timeout_ids(KM.CONFIG_LOOP);KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout(function(){KM.get_jpeg(d,c,a)},1))}}function c(n,p,q,o){if(o===KM.session_id.current){KM.update_feeds();if(n!=="null"){k++;k=(k>4)?0:k;e[k]=n;document.getElementById("image").src=e[k]}var l=(new Date()).getTime()-h;var m=Math.max(0,(500-l));KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout(function(){f()},m))}}};KM.conf_ptz_html=function(){KM.config.session_id=KM.session_id.current;KM.conf_config_track.reset();var c=340;var a=250;var b='<br><div style="float:left; width:360px;"><div class="margin_left_20px"><img id="image" style="width: '+c+"px; height: "+a+'px;" src="images/gcam.png" alt=""> <input type="button" id="ptz_left" style="width:85px;" OnClick="KM.conf_ptz_servo(1);" value="Left" disabled><input type="button" id="ptz_up" style="width:85px;" OnClick="KM.conf_ptz_servo(2);" value="Up" disabled><input type="button" id="ptz_down" style="width:85px;" OnClick="KM.conf_ptz_servo(3);" value="Down" disabled><input type="button" id="ptz_right" style="width:85px;" OnClick="KM.conf_ptz_servo(4);" value="Right" disabled></div></div><div class="config_tick_box"><input type="checkbox" id="ptz_enabled" onclick="KM.conf_ptz_enabled();">Enable PT(Z) mode. (Must be supported)</div><div class="divider"><img src="images/config_divider.png" alt="" ></div><div class="config_button disabled margin_top_4px" id="ptz_text_1">Driver : <select id="ptz_track" onchange="KM.conf_ptz_highlight_apply();" disabled><option value="1">1: stepper (motion tracking project)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option><option value="2">2: iomojo for the smilecam</option><option value="3">3: pwc driver for USB cameras</option><option value="4">4: generic </option><option value="5">5: uvcvideo driver for USB cameras</option><option value="6">6: reserved</option><option value="7">7: reserved</option><option value="8">8: reserved</option><option value="9">9: kmotion Axis 213 driver</option><option value="10">10: kmotion Axis 2130 driver</option><option value="11">11: kmotion Panasonic driver</option><option value="12">12: kmotion Foscam driver</option></select></div><br><div class="divider"><img src="images/config_divider.png" alt="" ></div><div class="config_tick_box disabled margin_top_4px" id="ptz_text_2"><input type="checkbox" id="ptz_calib_first" onclick="KM.conf_ptz_highlight_apply();" disabled>Auto recalibrate. (Causes addition pan / tilting)</div><div style="float:left; width:120px;" class="config_button disabled margin_top_4px" id="ptz_text_3">Steps Click X :<br>Button Delay :<br></div><div class="margin_top_4px"><input type="text" id="ptz_step_x" size="3" onfocus="KM.conf_ptz_highlight_apply();" disabled>&nbsp;<span class="config_text_basic disabled" id="ptz_text_4">&nbsp;&nbsp;&nbsp;Steps Click Y :&nbsp;&nbsp;<input type="text" id="ptz_step_y" size="3" onfocus="KM.conf_ptz_highlight_apply();" disabled>&nbsp;<br></span><input type="text" id="ptz_servo_settle" size="3" onfocus="KM.conf_ptz_highlight_apply();" disabled></div><div class="divider"><img src="images/config_divider.png" alt="" ></div><div class="config_button disabled margin_top_4px" id="ptz_text_5">Always <input type="button" id="ptz_calib"         OnClick="KM.conf_ptz_calibrate();" value="Calibrate PT(Z) to X0:Y0" disabled>  before moving<br>the camera and selecting any \'Set Position\'s.<br><br>Failure to do so may cause inaccurate positional<br>data to be stored.</div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box disabled margin_top_4px" id="ptz_text_6"><input type="checkbox" id="ptz_park_enabled" onclick="KM.conf_ptz_highlight_apply();" disabled>Enable auto park. Moves the camera to a set position if no activity for a preset time.</div><div class="config_button disabled margin_top_4px" id="ptz_text_7"><input type="button" id="ptz_park_1" OnClick="KM.conf_ptz_set_park();" value="Set Position" disabled><input type="button" id="ptz_park_2" OnClick="KM.conf_ptz_test_park();" value="Test" disabled> Auto park seconds : <input type="text" id="ptz_park_delay" size="3" onfocus="KM.conf_ptz_highlight_apply();" disabled>&nbsp;</div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="margin_top_4px"><div class="config_button disabled" id="ptz_text_8"><input type="button" id="ptz_preset_1" OnClick="KM.conf_ptz_set_preset(1);" value="Set Position" disabled><input type="button" id="ptz_preset_2" OnClick="KM.conf_ptz_test_preset(1);" value="Test" disabled> Preset 1: Activated by executing \'kmotion_ptz '+KM.config.camera+' 1\' in a BASH shell.</div><div class="config_button disabled" id="ptz_text_9"><input type="button" id="ptz_preset_3" OnClick="KM.conf_ptz_set_preset(2);" value="Set Position" disabled><input type="button" id="ptz_preset_4" OnClick="KM.conf_ptz_test_preset(2);" value="Test" disabled> Preset 2: Activated by executing \'kmotion_ptz '+KM.config.camera+' 2\' in a BASH shell.</div><div class="config_button disabled" id="ptz_text_10"><input type="button" id="ptz_preset_5" OnClick="KM.conf_ptz_set_preset(3);" value="Set Position" disabled><input type="button" id="ptz_preset_6" OnClick="KM.conf_ptz_test_preset(3);" value="Test" disabled > Preset 3: Activated by executing \'kmotion_ptz '+KM.config.camera+' 3\' in a BASH shell.</div><div class="config_button disabled" id="ptz_text_11"><input type="button" id="ptz_preset_7" OnClick="KM.conf_ptz_set_preset(4);" value="Set Position" disabled><input type="button" id="ptz_preset_8" OnClick="KM.conf_ptz_test_preset(4);" value="Test" disabled> Preset 4: Activated by executing \'kmotion_ptz '+KM.config.camera+' 4\' in a BASH shell.</div></div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_button margin_top_4px" id="ptz_text_12"><input type="button" id="ptz_apply" OnClick="KM.conf_ptz_apply();" value="Apply"> all changes to the local browser configuration and sync with the remote server.</div>';if(KM.www_rc.ptz_enabled[KM.config.camera]){b=b.replace(/disabled/g,"");b=b.replace(/gcam.png/,"bcam.png");KM.conf_live_feed_daemon(KM.session_id.current,KM.config.camera)}document.getElementById("config_html").innerHTML=b;document.getElementById("ptz_enabled").checked=KM.www_rc.ptz_enabled[KM.config.camera];document.getElementById("ptz_track").selectedIndex=KM.www_rc.ptz_track_type[KM.config.camera]-1;document.getElementById("ptz_calib_first").checked=KM.www_rc.ptz_calib_first[KM.config.camera];document.getElementById("ptz_step_x").value=KM.www_rc.ptz_step_x[KM.config.camera];document.getElementById("ptz_step_y").value=KM.www_rc.ptz_step_y[KM.config.camera];document.getElementById("ptz_servo_settle").value=KM.www_rc.ptz_servo_settle[KM.config.camera];document.getElementById("ptz_park_enabled").checked=KM.www_rc.ptz_park_enabled[KM.config.camera];document.getElementById("ptz_park_delay").value=KM.www_rc.ptz_park_delay[KM.config.camera];KM.config.ptz_alert_status_1=false};KM.conf_ptz_servo=function(a){KM.exe_script("/cgi_bin/xmlHttp_ptz.py","crf"+KM.pad_out2(KM.config.camera)+"b"+KM.pad_out2(a)+"$");KM.conf_ptz_grey_LUDR();if(a===1){KM.config.ptz_current_x-=KM.www_rc.ptz_step_x[KM.config.camera]}else{if(a===2){KM.config.ptz_current_y+=KM.www_rc.ptz_step_y[KM.config.camera]}else{if(a===3){KM.config.ptz_current_y-=KM.www_rc.ptz_step_y[KM.config.camera]}else{KM.config.ptz_current_x+=KM.www_rc.ptz_step_x[KM.config.camera]}}}};KM.conf_ptz_calibrate=function(){KM.conf_ptz_grey_LUDR();KM.exe_script("/cgi_bin/xmlHttp_ptz.py","caf"+KM.pad_out2(KM.config.camera)+"x5000y5000$");KM.config.ptz_current_x=0;KM.config.ptz_current_y=0};KM.conf_ptz_set_park=function(){KM.www_rc.ptz_park_x[KM.config.camera]=KM.config.ptz_current_x;KM.www_rc.ptz_park_y[KM.config.camera]=KM.config.ptz_current_y;KM.conf_ptz_highlight_apply()};KM.conf_ptz_test_park=function(){KM.conf_ptz_grey_LUDR();KM.config.ptz_current_x=KM.www_rc.ptz_park_x[KM.config.camera];KM.config.ptz_current_y=KM.www_rc.ptz_park_y[KM.config.camera];KM.exe_script("/cgi_bin/xmlHttp_ptz.py","caf"+KM.pad_out2(KM.config.camera)+"x"+KM.pad_out4(KM.www_rc.ptz_park_x[KM.config.camera]+5000)+"y"+KM.pad_out4(KM.www_rc.ptz_park_y[KM.config.camera]+5000)+"$")};KM.conf_ptz_set_preset=function(a){KM.www_rc["ptz_preset"+a+"_x"][KM.config.camera]=KM.config.ptz_current_x;KM.www_rc["ptz_preset"+a+"_y"][KM.config.camera]=KM.config.ptz_current_y;KM.conf_ptz_highlight_apply()};KM.conf_ptz_test_preset=function(a){KM.conf_ptz_grey_LUDR();KM.config.ptz_current_x=KM.www_rc["ptz_preset"+a+"_x"][KM.config.camera];KM.config.ptz_current_y=KM.www_rc["ptz_preset"+a+"_y"][KM.config.camera];KM.exe_script("/cgi_bin/xmlHttp_ptz.py","caf"+KM.pad_out2(KM.config.camera)+"x"+KM.pad_out4(KM.www_rc["ptz_preset"+a+"_x"][KM.config.camera]+5000)+"y"+KM.pad_out4(KM.www_rc["ptz_preset"+a+"_y"][KM.config.camera]+5000)+"$")};KM.conf_ptz_enabled=function(){KM.conf_config_track.ptz_en_tt_modified(KM.config.camera);KM.conf_ptz_highlight_apply();if(document.getElementById("ptz_enabled").checked){KM.conf_ptz_ungrey()}else{KM.conf_ptz_grey()}};KM.conf_ptz_highlight_apply=function(){document.getElementById("ptz_apply").style.fontWeight="bold";document.getElementById("ptz_apply").style.color=KM.BLUE;document.getElementById("ptz_text_12").style.color=KM.BLUE};KM.conf_ptz_grey=function(){KM.session_id.current++;KM.conf_error_daemon(KM.session_id.current);KM.conf_ptz_grey_LUDR();var b=["ptz_track","ptz_calib_first","ptz_step_x","ptz_step_y","ptz_servo_settle","ptz_calib","ptz_park_enabled","ptz_park_delay","ptz_park_1","ptz_park_2","ptz_preset_1","ptz_preset_2","ptz_preset_3","ptz_preset_4","ptz_preset_5","ptz_preset_6","ptz_preset_7","ptz_preset_8"];for(var a=0;a<b.length;a++){document.getElementById(b[a]).disabled=true}for(var a=1;a<12;a++){document.getElementById("ptz_text_"+a).style.color=KM.GHOST}document.getElementById("image").src="images/gcam.png"};KM.conf_ptz_grey_LUDR=function(){var b=["ptz_left","ptz_up","ptz_down","ptz_right"];for(var a=0;a<b.length;a++){document.getElementById(b[a]).disabled=true}};KM.conf_ptz_ungrey=function(){KM.conf_live_feed_daemon(KM.session_id.current,KM.config.camera);var b=["ptz_track","ptz_calib_first","ptz_step_x","ptz_step_y","ptz_servo_settle","ptz_calib","ptz_park_enabled","ptz_park_delay","ptz_park_1","ptz_park_2","ptz_preset_1","ptz_preset_2","ptz_preset_3","ptz_preset_4","ptz_preset_5","ptz_preset_6","ptz_preset_7","ptz_preset_8"];for(var a=0;a<b.length;a++){document.getElementById(b[a]).disabled=false}var b=["ptz_left","ptz_up","ptz_down","ptz_right"];for(var a=0;a<b.length;a++){document.getElementById(b[a]).disabled=false}for(var a=1;a<12;a++){document.getElementById("ptz_text_"+a).style.color=KM.DARK_GREY}document.getElementById("image").src="images/bcam.png"};KM.conf_ptz_ungrey_LUDR=function(){if(KM.www_rc.ptz_enabled[KM.config.camera]&&KM.config.session_id===KM.session_id.current){var b=["ptz_left","ptz_up","ptz_down","ptz_right"];for(var a=0;a<b.length;a++){document.getElementById(b[a]).disabled=false}}};KM.conf_ptz_apply=function(){KM.www_rc.ptz_enabled[KM.config.camera]=document.getElementById("ptz_enabled").checked;KM.www_rc.ptz_calib_first[KM.config.camera]=document.getElementById("ptz_calib_first").checked;KM.www_rc.ptz_servo_settle[KM.config.camera]=document.getElementById("ptz_servo_settle").value;KM.www_rc.ptz_park_enabled[KM.config.camera]=document.getElementById("ptz_park_enabled").checked;if(KM.www_rc.ptz_step_x[KM.config.camera]!==parseInt(document.getElementById("ptz_step_x").value,10)||KM.www_rc.ptz_step_y[KM.config.camera]!==parseInt(document.getElementById("ptz_step_y").value,10)){var a=parseInt(document.getElementById("ptz_step_x").value,10);var d=parseInt(document.getElementById("ptz_step_y").value,10);if(isNaN(a)){a=0}if(isNaN(d)){d=0}KM.www_rc.ptz_step_x[KM.config.camera]=a;KM.www_rc.ptz_step_y[KM.config.camera]=d;document.getElementById("ptz_step_x").value=a;document.getElementById("ptz_step_y").value=d}if(KM.www_rc.ptz_track_type[KM.config.camera]!==parseInt(document.getElementById("ptz_track").value,10)){KM.www_rc.ptz_track_type[KM.config.camera]=document.getElementById("ptz_track").value;KM.conf_config_track.ptz_en_tt_modified(KM.config.camera)}var c=parseFloat(document.getElementById("ptz_servo_settle").value,10);if(isNaN(c)){c=0}KM.www_rc.ptz_servo_settle[KM.config.camera]=c;document.getElementById("ptz_servo_settle").value=c;var b=parseInt(document.getElementById("ptz_park_delay").value,10);if(isNaN(b)){b=0}KM.www_rc.ptz_park_delay[KM.config.camera]=b;document.getElementById("ptz_park_delay").value=b;document.getElementById("ptz_apply").style.fontWeight="normal";document.getElementById("ptz_apply").style.color=KM.BLACK;document.getElementById("ptz_text_12").style.color=KM.DARK_GREY;KM.conf_config_track.ptz_misc_modified(KM.config.camera);KM.conf_config_track.sync()};KM.conf_error_html=function(){document.getElementById("config_html").innerHTML='<br><div id="error_text" class="config_error_block"></div>';var a=KM.config.error_str.split("\n");for(var c=0;c<a.length;c++){if(a[c].search(KM.config.error_search_str)!==-1){a[c]='<span style="color:'+KM.RED+';">'+a[c]+"</span>"}}var b=a.join("<br>");document.getElementById("error_text").innerHTML=b};KM.conf_load_html=function(){var b=KM.session_id.current;var e=750;document.getElementById("config_html").innerHTML='<br><div id="server_info" class="config_text_center">Please wait - Downloading server data.</div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div id="load_av_title" class="config_text_center">Load Averages</div>'+a("1 min",1)+a("5 min",2)+a("15 min",3)+'<div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div id="cpu_title" class="config_text_center">Central Processing Unit</div>'+a("User",4)+a("System",5)+a("IO Wait",6)+'<div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div id="memory_title" class="config_text_center">Memory</div>'+a("System",7)+a("Buffered",8)+a("Cached",9)+'<div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div id="swap_title" class="config_text_center">Swap</div>'+a("Swap",10);function a(k,h){if(KM.browser.browser_IE){return'<div class="bar_bground margin_top_4px"><div id="bar_fground'+h+'" class="bar_fground"></div><span id="bar_text'+h+'" class="bar_text_IE">'+k+'</span><span id="bar_value'+h+'" class="bar_text_IE"></span></div>'}else{return'<div class="bar_bground  margin_top_4px"><span id="bar_text'+h+'" class="bar_text">'+k+'</span><span id="bar_value'+h+'" class="bar_value"></span><div id="bar_fground'+h+'" class="bar_fground"></div></div>'}}function c(n){var h={};var m=n.split("$");for(var l=1;l<m.length;l++){var k=m[l].substr(0,2);if(k==="bx"||k==="sr"||k==="up"){h[k]=m[l].substr(3)}else{h[k]=parseFloat(m[l].substr(3),10)}}d(h);g(h)}function d(h){document.getElementById("server_info").innerHTML=h.bx+" "+h.sr+" Uptime "+h.up;document.getElementById("memory_title").innerHTML="Memory "+h.mt+"k";document.getElementById("swap_title").innerHTML="Swap "+h.st+"k"}function g(k){document.getElementById("bar_value1").innerHTML=k.l1;var l=Math.min(k.l1,1.5);document.getElementById("bar_fground1").style.width=(l*(e/1.5))+"px";document.getElementById("bar_value2").innerHTML=k.l2;l=Math.min(k.l2,1.5);document.getElementById("bar_fground2").style.width=(l*(e/1.5))+"px";if(l>=1){document.getElementById("bar_fground2").style.backgroundColor=KM.RED}else{document.getElementById("bar_fground2").style.backgroundColor=KM.BAR}document.getElementById("bar_value3").innerHTML=k.l3;l=Math.min(k.l3,1.5);document.getElementById("bar_fground3").style.width=(l*(e/1.5))+"px";if(l>=1){document.getElementById("bar_fground3").style.backgroundColor=KM.RED}else{document.getElementById("bar_fground3").style.backgroundColor=KM.BAR}document.getElementById("bar_value4").innerHTML=k.cu+"%";l=(k.cu/100)*e;document.getElementById("bar_fground4").style.width=l+"px";document.getElementById("bar_value5").innerHTML=k.cs+"%";l=(k.cs/100)*e;document.getElementById("bar_fground5").style.width=l+"px";document.getElementById("bar_value6").innerHTML=k.ci+"%";l=(k.ci/100)*e;document.getElementById("bar_fground6").style.width=l+"px";var h=k.mf+k.mb+k.mc;var m=k.mt-h;document.getElementById("bar_value7").innerHTML=m+"k";l=(m/k.mt)*e;document.getElementById("bar_fground7").style.width=l+"px";document.getElementById("bar_value8").innerHTML=k.mb+"k";l=(k.mb/k.mt)*e;document.getElementById("bar_fground8").style.width=l+"px";document.getElementById("bar_value9").innerHTML=k.mc+"k";l=(k.mc/k.mt)*e;document.getElementById("bar_fground9").style.width=l+"px";document.getElementById("bar_value10").innerHTML=k.su+"k";k.st=Math.max(k.st,1);l=(k.su/k.st);document.getElementById("bar_fground10").style.width=(l*e)+"px";if(l>=0.1){document.getElementById("bar_fground10").style.backgroundColor=KM.RED}else{document.getElementById("bar_fground10").style.backgroundColor=KM.BAR}}function f(){function k(){var l=KM.get_xmlHttp_obj();l.onreadystatechange=function(){if(l.readyState===4){l.onreadystatechange=null;var m=l.responseText;if(parseInt(m.substr(m.length-4),10)===m.length-8&&KM.session_id.current===b){c(m)}}};l.open("GET","/cgi_bin/xmlHttp_load.py?rnd="+new Date().getTime(),true);l.send(null)}function h(){k();if(KM.session_id.current===b){KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout(function(){h()},2000))}}h()}f()};KM.display_about=function(){KM.session_id.current++;var a="title_FF";if(KM.browser.browser_OP){a="title_OP"}if(KM.browser.browser_IE){a="title_IE"}document.getElementById("main_display").innerHTML='<div id="'+a+'"><span class="italic">kmotion</span>: About</div><div class="divider"><img src="images/divider_xl.png" alt="" /></div><div class="para_msg"><p>My name is Dave Selby the developer of kmotion and <span class="link_word" onClick="javascript: KM.about_link_to(\'http://code.google.com/p/kmotion2\');">kmotion v2</span>. This is my pet project which I develop in my spare time. Unfortunately I don\'t work in the IT industry but if you email me at dave6502@googlemail.com I will send you my CV ;)</p><p>On a personal note I would like to thank <span class="link_word" onClick="javascript: KM.about_link_to(\'http://picasaweb.google.com/jazzcommunication\');">Gudy</span> for his many many hours of testing and bug reporting on the \'live\' code. kmotion v2 would not be where it is now without his help - thank you Gudy.</p><p>I would also like to thank <span class="link_word" onClick="javascript: KM.about_link_to(\'http://www.prunk.si\');">Jan Prunk </span>for providing the <span class="link_word" onClick="javascript: KM.about_link_to(\'http://www.kmotion.eu\');">\'www.kmotion.eu\' </span>domain, website and blog all without charge allowing kmotion to move to the next level - thank you Jan.</p><p>And I would like to thank <span class="link_word" onClick="javascript: KM.about_link_to(\'http://www.wingware.com/\');">Wingware</span> for supplying a copy of their superb Python IDE without which this project would have taken much much longer. It has also proven itself as an excellent Javascript, BASH, HTML and CSS editor!</p><p>Lastly if you like the software please feel free to drop me some $ via paypal to the above address. Failing that if you are as poor as me, do me a favour and send me a screenshot of your site. If you give permission I will paste it on the site. Enjoy.</p><p>Released under the <span class="link_word" onClick="javascript: KM.about_link_to(\'http://www.gnu.org/licenses/gpl.html\');">GPL v3.</span></p></div>'};KM.about_link_to=function(a){document.getElementById("main_display").innerHTML='<object data="'+a+'" type="text/html"width="100%" height="100%"</object>'};KM.display_msg=function(){KM.session_id.current++;if(KM.www_rc.msg.length<5){var a="title_FF";if(KM.browser.browser_OP){a="title_OP"}if(KM.browser.browser_IE){a="title_IE"}document.getElementById("main_display").innerHTML='<div id="'+a+'">';document.getElementById("main_display").innerHTML='<div id="'+a+'"><span class="italic">kmotion</span>: Msg</div><div class="divider"><img src="images/divider_xl.png" alt="" /></div><div class="para_msg"><p style="text-align: center">No Messages ...</p></div>'}else{document.getElementById("main_display").innerHTML='<div class="para_msg">'+KM.collapse_chars(KM.www_rc.msg)+"</div>"}};KM.init1=function(){KM.feed_cache_setup();KM.update_feeds();var a=KM.init2;KM.load_settings(a)};KM.init2=function(b){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){a()},1000));function a(){KM.background_button_clicked(KM.www_rc.color_select);KM.enable_display_buttons(KM.www_rc.display_select);KM.enable_camera_buttons();if(KM.www_rc.msg.length<5){KM.enable_function_buttons(1);KM.function_button_clicked(1)}else{KM.enable_function_buttons(7);KM.function_button_clicked(7)}}};KM.init1();